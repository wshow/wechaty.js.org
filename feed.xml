<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="https://wechaty.js.org/feed.xml" rel="self" type="application/atom+xml" /><link href="https://wechaty.js.org/" rel="alternate" type="text/html" /><updated>2022-01-26T13:30:39+00:00</updated><id>https://wechaty.js.org/feed.xml</id><title type="html">Wechaty</title><subtitle>Conversational RPA SDK for Chatbot Makers</subtitle><entry><title type="html">2022-åŸºäº5Gå¹³å°å¼€å‘puppetæ¨¡å—æ¥å…¥wechaty</title><link href="https://wechaty.js.org/2022/01/18/monthly-wechaty-puppet-walnut-report/" rel="alternate" type="text/html" title="2022-åŸºäº5Gå¹³å°å¼€å‘puppetæ¨¡å—æ¥å…¥wechaty" /><published>2022-01-18T00:00:00+00:00</published><updated>2022-01-18T00:00:00+00:00</updated><id>https://wechaty.js.org/2022/01/18/monthly-wechaty-puppet-walnut-report</id><content type="html" xml:base="https://wechaty.js.org/2022/01/18/monthly-wechaty-puppet-walnut-report/"><![CDATA[<h2 id="åŸºäº-5g-å¹³å°å¼€å‘-puppet-æ¨¡å—æ¥å…¥-wechaty">åŸºäº 5G å¹³å°å¼€å‘ puppet æ¨¡å—æ¥å…¥ wechaty</h2>

<ul>
  <li>é¡¹ç›®åç§°ï¼šåŸºäº5Gæ¶ˆæ¯çš„ Wechaty Puppet æ¨¡å—çš„è®¾è®¡ä¸å®ç°</li>
  <li>å­¦ç”Ÿï¼šé²è€€é¾™</li>
  <li>å¯¼å¸ˆï¼šè‹ç•…</li>
  <li>é¡¹ç›®ä»‹ç»ï¼š<a href="https://github.com/juzibot/intern/issues/1">https://github.com/juzibot/intern/issues/1</a></li>
  <li>ä»£ç åœ°å€ï¼š<a href="https://github.com/wechaty/puppet-walnut">https://github.com/wechaty/puppet-walnut</a></li>
</ul>

<h3 id="èƒŒæ™¯ä»‹ç»">èƒŒæ™¯ä»‹ç»</h3>

<ul>
  <li>Wechaty ç¤¾åŒºç›®å‰å·²ç»æ”¯æŒå¾®ä¿¡ã€Whatsappã€ä¼ä¸šå¾®ä¿¡ã€é£ä¹¦ç­‰å¸¸è§æµè¡Œå³æ—¶é€šè®¯å·¥å…·ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡å¤šè¯­è¨€ SDK ï¼ˆæ¯”å¦‚ Python Wechatyï¼‰ è¿›è¡Œè°ƒç”¨ã€‚</li>
  <li><a href="https://wechaty.js.org/2021/03/27/rcs-messaging-chatbot/">5G Chatbot (RCS)</a> æ˜¯è¿‘æœŸä¸­å›½ç”µä¿¡è¿è¥å•†åŸºäº 5G çš„æ¶ˆæ¯æˆ˜ç•¥è½åœ°å¹³å°ï¼Œæœªæ¥çš„ 5G æ‰‹æœºå°†ä¼šå†…ç½® RCS æ¶ˆæ¯çš„å¤„ç†èƒ½åŠ›ã€‚</li>
  <li><a href="https://www.5g-msg.com/#/">ç¡¬æ ¸æ¡ƒç¤¾åŒº</a> çš„ <a href="https://wechaty.js.org/2021/03/27/rcs-messaging-chatbot/">ç”µä¿¡è¿è¥å•†å•†5G Chatbot</a> å¹³å°ã€‚</li>
</ul>

<h3 id="ç›®æ ‡è®¡åˆ’">ç›®æ ‡è®¡åˆ’</h3>

<ul>
  <li>åŸºäº 5G å¹³å°çš„å¼€æ”¾ api è¿›è¡Œå°è£…ï¼Œå®ç°ç®€å•çš„<code class="language-plaintext highlighter-rouge">ding-dong-bot</code>ã€‚</li>
  <li>ä¸°å¯Œ 5G çš„æ¶ˆæ¯æ¨¡å¼ï¼Œå®ç°æ”¯æŒå¯Œæ–‡æœ¬ã€æ–‡ä»¶ã€cssç­‰å¤šæ ·æ¶ˆæ¯æ ¼å¼çš„ puppetã€‚</li>
</ul>

<h3 id="é¡¹ç›®è¿›å±•">é¡¹ç›®è¿›å±•</h3>

<ul>
  <li>å®Œå–„ walnut ä»“åº“çš„ README å’Œ getting-startedã€‚</li>
  <li>å®Œå–„å¯¹äº wechaty contact å’Œ message éƒ¨åˆ† api çš„æ”¯æŒã€‚</li>
</ul>

<h3 id="contact-api-æ”¯æŒ">Contact Api æ”¯æŒ</h3>

<ul>
  <li>
    <h4 id="properties"><a href="https://wechaty.js.org/docs/api/contact#properties">Properties</a></h4>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Support</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>id</td>
          <td><code class="language-plaintext highlighter-rouge">string</code></td>
          <td>Get Contact id. This function is depending on the Puppet Implementation, see <a href="https://github.com/wechaty/wechaty/wiki/Puppet#3-puppet-compatible-table">puppet-compatible-table</a></td>
          <td>âœ…</td>
          <td>Phone number</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <h4 id="instance-methods"><a href="https://wechaty.js.org/docs/api/contact#instance-methods">Instance Methods</a></h4>

    <table>
      <thead>
        <tr>
          <th>Instance Methods</th>
          <th>Return type</th>
          <th>Support</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>say(text Or Contact Or File)</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âœ…</td>
          <td>âš Contact not Support</td>
        </tr>
        <tr>
          <td>name()</td>
          <td><code class="language-plaintext highlighter-rouge">String</code></td>
          <td>âœ…</td>
          <td>Phone number</td>
        </tr>
        <tr>
          <td>alias(newAlias)</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>friend()</td>
          <td><code class="language-plaintext highlighter-rouge">Boolean or null</code></td>
          <td>âœ…</td>
          <td>True</td>
        </tr>
        <tr>
          <td>type()</td>
          <td><code class="language-plaintext highlighter-rouge">ContactType.Unknown or ContactType.Personal or ContactType.Official</code></td>
          <td>âœ…</td>
          <td>ContactType.Personal</td>
        </tr>
        <tr>
          <td>gender()</td>
          <td><code class="language-plaintext highlighter-rouge">ContactGender.Unknown or ContactGender.Male or ContactGender.Female</code></td>
          <td>âœ…</td>
          <td>ContactGender.Unknown</td>
        </tr>
        <tr>
          <td>province()</td>
          <td><code class="language-plaintext highlighter-rouge">String or null</code></td>
          <td>âŒ</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>city()</td>
          <td><code class="language-plaintext highlighter-rouge">String or null</code></td>
          <td>âŒ</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>avatar()</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âœ…</td>
          <td>Default avatar</td>
        </tr>
        <tr>
          <td>sync()</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>self()</td>
          <td><code class="language-plaintext highlighter-rouge">Boolean</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p>Default avatar ğŸ‘‰ <a href="https://raw.githubusercontent.com/wechaty/puppet-walnut/main/docs/images/avatar.webp">https://raw.githubusercontent.com/wechaty/puppet-walnut/main/docs/images/avatar.webp</a></p>
    </blockquote>
  </li>
  <li>
    <h4 id="static-methods"><a href="https://wechaty.js.org/docs/api/contact#static-methods">Static Methods</a></h4>

    <table>
      <thead>
        <tr>
          <th>Static Methods</th>
          <th>Return Type</th>
          <th>Support</th>
          <th>Detail</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>find(query)</td>
          <td><code class="language-plaintext highlighter-rouge">Promise &lt;Contact | null&gt;</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>findAll(Query Arguements)</td>
          <td><code class="language-plaintext highlighter-rouge">Promise &lt;Contact []&gt;</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<h3 id="message-api-æ”¯æŒ">Message Api æ”¯æŒ</h3>

<ul>
  <li>
    <h4 id="instance-methods-1"><a href="https://wechaty.js.org/docs/api/message#instance-methods">Instance Methods</a></h4>

    <table>
      <thead>
        <tr>
          <th>Instance methods</th>
          <th>Return type</th>
          <th>Support</th>
          <th>Detail</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>from()</td>
          <td><code class="language-plaintext highlighter-rouge">Contact</code> or <code class="language-plaintext highlighter-rouge">null</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>to()</td>
          <td><code class="language-plaintext highlighter-rouge">Contact</code> or <code class="language-plaintext highlighter-rouge">null</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>room()</td>
          <td><code class="language-plaintext highlighter-rouge">Room</code> or <code class="language-plaintext highlighter-rouge">null</code></td>
          <td>âœ…</td>
          <td>null</td>
        </tr>
        <tr>
          <td>text()</td>
          <td><code class="language-plaintext highlighter-rouge">string</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>say(text Or Contact Or File)</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âœ…</td>
          <td>âš Contact not Support</td>
        </tr>
        <tr>
          <td>type()</td>
          <td><code class="language-plaintext highlighter-rouge">MessageType</code></td>
          <td>âœ…</td>
          <td>Message.Text</td>
        </tr>
        <tr>
          <td>self()</td>
          <td><code class="language-plaintext highlighter-rouge">boolean</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>mention()</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âŒ</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>mentionSelf()</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âŒ</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>forward(to)</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>date()</td>
          <td><code class="language-plaintext highlighter-rouge">Date</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>age()</td>
          <td><code class="language-plaintext highlighter-rouge">Number</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>toFileBox()</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>toContact()</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âŒ</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>toUrlLink()</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <h4 id="static-method"><a href="https://wechaty.js.org/docs/api/message#static-method">Static Method</a></h4>

    <table>
      <thead>
        <tr>
          <th>Static Methods</th>
          <th>Return type</th>
          <th>Support</th>
          <th>Detail</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>find()</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>findAll()</td>
          <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
          <td>âœ…</td>
          <td>Â </td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<h3 id="è§†é¢‘å±•ç¤º">è§†é¢‘å±•ç¤º</h3>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="https://www.youtube.com/embed/K5CIaL6x83k" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<h3 id="ç­”è¾©æŠ¥å‘Š">ç­”è¾©æŠ¥å‘Š</h3>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="/assets/2022/01-monthly-wechaty-puppet-walnut-report/monthly-wechaty-puppet-walnut-report" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<h3 id="è®¡åˆ’å®‰æ’">è®¡åˆ’å®‰æ’</h3>

<ul>
  <li>å®Œæˆå›¾ç‰‡å’Œåœ°ç†ä½ç½®å¡ç‰‡æ¶ˆæ¯çš„å®ç°ã€‚</li>
  <li>å°è£…å’ŒæŠ½è±¡æ¶ˆæ¯æ¨¡å—çš„æ•°æ®ç»“æ„ã€‚</li>
  <li>ä¼˜åŒ–é¡¹ç›®ç»“æ„ï¼Œè¿›è¡Œé¡¹ç›®éƒ¨ç½²å’Œç¨³å®šæ€§æµ‹è¯•ã€‚</li>
</ul>

<blockquote>
  <p>Author: <a href="https://github.com/fabian4">@fabian</a></p>
</blockquote>]]></content><author><name>fabian</name></author><category term="project" /><category term="5g" /><category term="puppet-walnut" /><category term="chatbot" /><category term="ecosystem" /><category term="plan" /><summary type="html"><![CDATA[åŸºäº 5G å¹³å°å¼€å‘ puppet æ¨¡å—æ¥å…¥ wechaty]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2022/01-monthly-wechaty-puppet-walnut-report/puppet-walnut.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2022/01-monthly-wechaty-puppet-walnut-report/puppet-walnut.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">åŸºäºWechatyçš„ä¸ªäººåŠ©ç†ï¼Œ++ç”Ÿæ´»æ•ˆç‡&amp;amp;&amp;amp;æœ‰æ•ˆå¯¹æŠ—å†…å·</title><link href="https://wechaty.js.org/2022/01/16/wechaty-assistant-bot-opensource/" rel="alternate" type="text/html" title="åŸºäºWechatyçš„ä¸ªäººåŠ©ç†ï¼Œ++ç”Ÿæ´»æ•ˆç‡&amp;amp;&amp;amp;æœ‰æ•ˆå¯¹æŠ—å†…å·" /><published>2022-01-16T00:00:00+00:00</published><updated>2022-01-16T00:00:00+00:00</updated><id>https://wechaty.js.org/2022/01/16/wechaty-assistant-bot-opensource</id><content type="html" xml:base="https://wechaty.js.org/2022/01/16/wechaty-assistant-bot-opensource/"><![CDATA[<h2 id="é¡¹ç›®åœ°å€">é¡¹ç›®åœ°å€</h2>

<p><a href="https://github.com/yzh1255245824/wechat-bot-padlocal">wechaty-assistant</a></p>

<h2 id="ä¸€å‰è¨€">ä¸€ã€å‰è¨€</h2>

<p>ç”±äºå¸¸å¹´ç©¿æ¢­äºè¯¸å¤šå°ä¼—ç½‘ç›˜çš„qqç¾¤ï¼Œæˆ‘æ¥è§¦åˆ°äº†ç¤¾äº¤è½¯ä»¶æœºå™¨äººè¿™ä¸ªæ¦‚å¿µã€‚åˆæ¬¡æ¥è§¦ï¼Œä¾¿è§‰å¾—ç”šæ˜¯æœ‰è¶£ï¼Œå› è€Œåœ¨ä¸€ç•ªæ£€ç´¢ä¹‹åï¼Œå¯»è®¿åˆ°äº†<code class="language-plaintext highlighter-rouge">wechaty</code>è¿™ä¸€å®åœ°ã€‚</p>

<p>èµ·åˆåªæ˜¯æƒ³åšä¸€ä¸ªåœ¨å¾®ä¿¡ç¾¤å†…å’Œç¾¤å‹èŠå¤©æ°´ç¾¤çš„æœºå™¨äººï¼Œåæ¥å‘ç°ä¸€äº›åœ¨é…·å®‰ä¸Šè´¹å°½å¿ƒæœºæ‰¾åˆ°çš„å®è—è½¯ä»¶çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œå¯ä»¥ç®€åŒ–ç§»æ¤åˆ°å¾®ä¿¡ä¸Šï¼Œä¾‹å¦‚<code class="language-plaintext highlighter-rouge">å¯†ç é”®ç›˜</code>è¿™ä¸€åŠŸèƒ½ã€‚è¿˜æœ‰<code class="language-plaintext highlighter-rouge">å®šæ—¶æ¶ˆæ¯</code>è¿™ç§ç”¨å¤„é¢‡å¤§çš„åŠŸèƒ½ï¼Œæ­¤å‰åªèƒ½æå‰ç¼–è¾‘å¥½æ¶ˆæ¯ï¼Œç„¶åæŒ‘ç¯å¤œæˆ˜ã€æ•æˆˆå¾…æ—¦ï¼Œæ—¶æœºä¸€åˆ°å°±æ‰‹åŠ¨ç‚¹å‡»å‘é€ï¼Œè€Œç°åœ¨å€ŸåŠ©<code class="language-plaintext highlighter-rouge">wechaty</code>ï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒè¿‡å¹´çš„æ—¶å€™12:00è¦å‘é€çš„æ‹œå¹´è¯·æ±‚è¿‡å¤šã€åŒåä¸€ä¹Ÿä¸å¿…å†çº ç»“æ˜¯å…ˆç»™å¥³å‹å‘é€æ‹çˆ±çºªå¿µæ—¥å¿«ä¹è¿˜æ˜¯å…ˆå»äº¬ä¸œä¸‹å•(å¤ªæ£’äº†ï¼ï¼)ã€‚</p>

<p>æœ¬é¡¹ç›®å€ŸåŠ©<code class="language-plaintext highlighter-rouge">padlocal</code>ä½œä¸ºpuppet-providerï¼Œé›†æˆäº†ä¸ªäººå¸¸ç”¨çš„APIæœåŠ¡å•†æ¥å£ï¼ŒåŒæ—¶æ¥å…¥äº†<code class="language-plaintext highlighter-rouge">å¾®ä¿¡å¯¹è¯å¼€æ”¾å¹³å°</code>ï¼Œä½ å¯ä»¥åˆ©ç”¨å†…åµŒçš„å°åŠŸèƒ½æ›¿ä»£å¹³æ—¶åœ¨ç½‘é¡µä¸­ä½¿ç”¨çš„åœ¨çº¿å°å·¥å…·ï¼Œä¹Ÿå¯ä»¥åœ¨å‡Œæ™¨å››ç‚¹ç»™å·ç‹ä»¬å‘é€â€œæˆ‘è¿˜åœ¨å­¦â€ï¼Œè¯¸å¤šåŠŸèƒ½å¯ç‚¹å‡»é¡¹ç›®åœ°å€ä¸‹æ–¹é“¾æ¥ä½“éªŒã€‚</p>

<p>å†æ¬¡ç‰¹åˆ«è‡´è°¢<code class="language-plaintext highlighter-rouge">wechaty</code>ç¤¾åŒºä¸€ä¼—å¼€å‘è€…ä»¬çš„è¾›å‹¤ä»˜å‡ºï¼Œæ„Ÿè°¢ä½ ä»¬çš„åˆ›é€ ã€‚</p>

<h2 id="äºŒä¸»è¦åŠŸèƒ½">äºŒã€ä¸»è¦åŠŸèƒ½</h2>

<h3 id="21-ç§èŠæ¶ˆæ¯å¤„ç†å…³é”®è¯å›å¤åŒ…æ‹¬">2.1 ç§èŠæ¶ˆæ¯å¤„ç†ï¼šå…³é”®è¯å›å¤ï¼ŒåŒ…æ‹¬</h3>

<p><img src="/assets/2022/01-wechaty-assistant-bot-opensource/menu.webp" alt="people-message" /></p>

<p>åœ¨çº¿å®æ—¶æ•°æ®è·å–æœåŠ¡ç”±APIæœåŠ¡å•†æä¾›</p>

<p>æ¯’é¸¡æ±¤
<img src="/assets/2022/01-wechaty-assistant-bot-opensource/poisonsoup.webp" alt="IMG_20220115_210015.jpg" /></p>

<p>ç¥å›å¤
<img src="/assets/2022/01-wechaty-assistant-bot-opensource/godreply.webp" alt="image.png" /></p>

<p>æ¯æ—¥è‹±è¯­
<img src="/assets/2022/01-wechaty-assistant-bot-opensource/oneen.webp" alt="IMG_20220115_205958.jpg" /></p>

<p>å…¨ç½‘çƒ­ç‚¹
<img src="/assets/2022/01-wechaty-assistant-bot-opensource/networkhots.webp" alt="image.png" /></p>

<p>åŸå¸‚å¤©æ°”
<img src="/assets/2022/01-wechaty-assistant-bot-opensource/weather.webp" alt="IMG_20220115_210107.jpg" /></p>

<p>å®¢æœ
<img src="/assets/2022/01-wechaty-assistant-bot-opensource/customerservice.webp" alt="image.png" /></p>

<p>æ–‡æœ¬å¤„ç†åŠŸèƒ½ç”±æœ¬åœ°ç¼–å†™ç®—æ³•å¤„ç†</p>

<p>è‹±æ–‡å­—ç¬¦ä¸²è½¬å¤§/å°å†™
<img src="/assets/2022/01-wechaty-assistant-bot-opensource/toupper.webp" alt="image.png" /></p>

<p>rgb<code class="language-plaintext highlighter-rouge">&lt;=&gt;</code>hex
<img src="/assets/2022/01-wechaty-assistant-bot-opensource/rgbtohex.webp" alt="image.png" /></p>

<h3 id="22-ç¾¤ç®¡ç†">2.2 ç¾¤ç®¡ç†</h3>

<p>é€šè¿‡ç§èŠçš„å¿«æ·æŒ‡ä»¤è‡ªåŠ¨æ‹‰äººå…¥ç¾¤
<code class="language-plaintext highlighter-rouge">è¸¢@ç”¨æˆ·å</code>å¿«æ·æŒ‡ä»¤è¸¢äºº</p>

<p><img src="/assets/2022/01-wechaty-assistant-bot-opensource/kicksb.webp" alt="image.png" /></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/* ç‰¹æƒæ¶ˆæ¯ */</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sender</span> <span class="o">===</span> <span class="nx">config</span><span class="p">.</span><span class="nx">MYSELF</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// è¸¢äººåŠŸèƒ½  ç¾¤é‡Œå‘é€  è¸¢@æŸæŸæŸ  å³å¯</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">"</span><span class="s2">è¸¢@</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">//å¦‚æœæ˜¯æœºå™¨äººå¥½å‹ä¸”æ˜µç§°æ˜¯è‡ªå·±çš„å¤§å·æ˜µç§°  æ‰æ‰§è¡Œè¸¢äººæ“ä½œ</span>
        <span class="c1">// edit at 0109ï¼šå¤‡æ³¨å¦‚æœæ— æ³•è·å–ï¼Œç­‰ä¸€æ®µæ—¶é—´æ•°æ®åˆ·æ–°å³å¯ã€‚è¸¢äººè¦ç®¡ç†å‘˜æƒé™</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">contact</span><span class="p">.</span><span class="nx">friend</span><span class="p">())</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">delName</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">è¸¢@</span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">è¸¢å‡º</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">delName</span><span class="p">);</span> <span class="c1">// debug</span>
          <span class="kd">const</span> <span class="nx">delContact</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">room</span><span class="p">.</span><span class="nx">member</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="nx">delName</span> <span class="p">});</span>
          <span class="k">await</span> <span class="nx">room</span><span class="p">.</span><span class="nx">del</span><span class="p">(</span><span class="nx">delContact</span><span class="p">);</span>
          <span class="k">await</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">delName</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">å·²è¢«ç§»é™¤ç¾¤èŠã€‚ä¸”èŠä¸”çæƒœå•Šï¼</span><span class="dl">"</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>æ£€æµ‹ç¾¤å†…éæ³•<code class="language-plaintext highlighter-rouge">url</code>å¹¶<code class="language-plaintext highlighter-rouge">@</code>æé†’å¯¹æ–¹</p>

<p><img src="/assets/2022/01-wechaty-assistant-bot-opensource/listenurl.webp" alt="image.png" /></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">urlReg</span> <span class="o">=</span>
  <span class="sr">/</span><span class="se">(</span><span class="sr">http</span><span class="se">(</span><span class="sr">s</span><span class="se">)?</span><span class="sr">:</span><span class="se">\/\/)?[</span><span class="sr">a-zA-Z0-9</span><span class="se">][</span><span class="sr">-a-zA-Z0-9</span><span class="se">]{0,62}(\.[</span><span class="sr">a-zA-Z0-9</span><span class="se">][</span><span class="sr">-a-zA-Z0-9</span><span class="se">]{0,62})</span><span class="sr">+</span><span class="se">(</span><span class="sr">:</span><span class="se">[</span><span class="sr">0-9</span><span class="se">]{1,5})?[</span><span class="sr">-a-zA-Z0-9()@:%_</span><span class="se">\\\+\.</span><span class="sr">~#?&amp;</span><span class="se">//</span><span class="sr">=</span><span class="se">]</span><span class="sr">*$/g</span><span class="p">;</span>  <span class="c1">// åŒ¹é…urlçš„æ­£åˆ™è¡¨è¾¾å¼(å®é™…æƒ…å†µä¸‹ï¼Œurlå‘é€è€…å¤šæ•°ä¸ä¼šæ·»åŠ http(s)å¤´)</span>

    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">urlReg</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">text</span><span class="p">()))</span> <span class="p">{</span>
      <span class="nx">urlReg</span><span class="p">.</span><span class="nx">lastIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// ç´¢å¼•é‡ç½®</span>

      <span class="kd">const</span> <span class="nx">testUrl</span> <span class="o">=</span> <span class="nx">urlReg</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">text</span><span class="p">());</span>

      <span class="kd">const</span> <span class="nx">valid</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">superagent</span><span class="p">.</span><span class="nx">checkUrl</span><span class="p">(</span><span class="nx">testUrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">valid</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">room</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">room</span><span class="p">();</span>
        <span class="c1">// const master = await room.member(config.BOTNAME);</span>
        <span class="k">await</span> <span class="nx">room</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span>
          <span class="s2">`@</span><span class="p">${</span><span class="nx">msg</span>
            <span class="p">.</span><span class="k">from</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">name</span><span class="p">()}</span><span class="s2"> ä¸ºäº†ç¾¤ä¸»ä¸ä¼—ç®¡ç†å‘˜çš„æ³•å¾‹å®‰å…¨ï¼Œæœ¬ç¾¤ç¦æ­¢å‘é€ä¸æ˜é“¾æ¥!!!`</span>
        <span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">é“¾æ¥ä¸åˆæ³•</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// debug</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<h3 id="23-è‡ªåŠ¨å¤„ç†å¥½å‹è¯·æ±‚">2.3 è‡ªåŠ¨å¤„ç†å¥½å‹è¯·æ±‚</h3>

<ul>
  <li>è‡ªåŠ¨é€šè¿‡å¥½å‹è¯·æ±‚</li>
  <li>å¯é™åˆ¶é€šè¿‡å¡«å†™æŒ‡å®šéªŒè¯æ¶ˆæ¯çš„å¥½å‹ï¼Œé¿å…é™Œç”Ÿäººæ·»åŠ å¥½å‹</li>
</ul>

<h3 id="24-æ™ºèƒ½å¯¹è¯æ¥å…¥å¾®ä¿¡å¯¹è¯å¼€æ”¾å¹³å°">2.4 æ™ºèƒ½å¯¹è¯ï¼ˆæ¥å…¥å¾®ä¿¡å¯¹è¯å¼€æ”¾å¹³å°ï¼‰</h3>

<p>æœªè¢«å…³é”®è¯æ•è·çš„æ¶ˆæ¯å°†ç”±<strong>è®­ç»ƒå¥½çš„AI</strong>æ™ºèƒ½å›å¤</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">WXAI_TOKEN</span><span class="p">:</span> <span class="dl">"</span><span class="s2">your token</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// å¾®ä¿¡å¯¹è¯å¼€æ”¾å¹³å°token</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">WXAI</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://openai.weixin.qq.com/openapi/</span><span class="dl">"</span><span class="p">;</span>  <span class="c1">// å¾®ä¿¡å¯¹è¯å¼€æ”¾å¹³å°</span>

<span class="cm">/**
 * @function è·å–APIç­¾åï¼Œ2å°æ—¶è¿‡æœŸ
 * @returns ç­¾å
 * @tips æ”¹ä¸ºè½®è¯¢
 */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">getSignature</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span><span class="nx">signature</span><span class="p">}</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">WXAI</span><span class="p">}</span><span class="s2">sign/</span><span class="p">${</span><span class="nx">WXAI_TOKEN</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">userid</span><span class="p">:</span> <span class="dl">'</span><span class="s1">anything</span><span class="dl">'</span> <span class="c1">// è¿™é‡Œå¯ä»¥æ˜¯ä»»æ„å€¼</span>
  <span class="p">})).</span><span class="nx">data</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">signature</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
 * @function è°ƒç”¨AIæ¥å£ï¼Œè·å–ç­”æ¡ˆ
 * @param {ç­¾å} signature
 * @param {ç”¨æˆ·id} userid 
 * @param {æ¥æ”¶åˆ°çš„æ–‡æœ¬} text 
 * @returns AIç»™å‡ºçš„ç­”æ¡ˆ
 */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">getAnswer</span><span class="p">(</span><span class="nx">signature</span><span class="p">,</span> <span class="nx">userid</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span><span class="nx">answer</span><span class="p">}</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">WXAI</span><span class="p">}</span><span class="s2">aibot/</span><span class="p">${</span><span class="nx">WXAI_TOKEN</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">signature</span><span class="p">:</span> <span class="nx">signature</span><span class="p">,</span>
      <span class="na">userid</span><span class="p">:</span> <span class="nx">userid</span><span class="p">,</span>
      <span class="na">query</span><span class="p">:</span> <span class="nx">text</span><span class="p">,</span>
  <span class="p">})).</span><span class="nx">data</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">answer</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¾®ä¿¡å¯¹è¯å¼€æ”¾å¹³å°è¯¦ç»†é…ç½®å¯å»<code class="language-plaintext highlighter-rouge">å››</code>ä¸­é“¾æ¥å‡ºæŸ¥é˜…</p>

<h3 id="25-è®¾ç½®å®šæ—¶ä»»åŠ¡å¯å¾ªç¯å¯å•æ¬¡">2.5 è®¾ç½®å®šæ—¶ä»»åŠ¡(å¯å¾ªç¯ã€å¯å•æ¬¡ï¼‰</h3>

<p>å®šæ—¶å‘é€ç¾¤æ¶ˆæ¯ï¼Œç™»å½•æ—¶ä»»åŠ¡å¼€å§‹æ‰§è¡Œ</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="cm">/**
    * @func 8ç‚¹åŠå®šæ—¶ç»™æŒ‡å®šç¾¤å‘é€æ¶ˆæ¯
    */</span>
   <span class="k">async</span> <span class="kd">function</span> <span class="nx">rolling</span><span class="p">()</span> <span class="p">{</span>
     <span class="nx">schedule</span><span class="p">.</span><span class="nx">setSchedule</span><span class="p">(</span> <span class="c1">// node-scheduleä½¿ç”¨æ–¹æ³•å¯è§å®˜æ–¹æ–‡æ¡£,æ­¤å¤„è¯­æ³•ä¸å”¯ä¸€</span>
       <span class="p">{</span>
         <span class="na">hour</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
         <span class="na">minute</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
       <span class="p">},</span>
   
       <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="kd">const</span> <span class="nx">room</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">bot</span><span class="p">.</span><span class="nx">Room</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
           <span class="na">topic</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">WEBROOM</span><span class="p">,</span>
         <span class="p">});</span>
         <span class="kd">const</span> <span class="nx">today</span> <span class="o">=</span> <span class="nx">moment</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="dl">"</span><span class="s2">MMæœˆDDæ—¥</span><span class="dl">"</span><span class="p">);</span>
         <span class="kd">let</span> <span class="nx">poison</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">superagent</span><span class="p">.</span><span class="nx">getSoup</span><span class="p">();</span> <span class="c1">//æ¯’é¸¡æ±¤</span>
         <span class="kd">const</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">`ä»Šå¤©æ˜¯</span><span class="p">${</span><span class="nx">today</span><span class="p">}</span><span class="s2">,ä½ å­¦åºŸäº†å—?</span><span class="p">${</span><span class="nx">poison</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
         <span class="k">await</span> <span class="nx">room</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
       <span class="p">}</span>
     <span class="p">);</span>
   <span class="p">}</span>
</code></pre></div></div>

<p>å®šæ—¶ç»™ä¸ªäººå‘é€æ¶ˆæ¯</p>

<p><img src="/assets/2022/01-wechaty-assistant-bot-opensource/schedule.webp" alt="image.png" /></p>

<p><code class="language-plaintext highlighter-rouge">2022å¹´1æœˆ14æ—¥4ç‚¹0åˆ†0ç§’</code>å‘å¤‡æ³¨ä¸º<code class="language-plaintext highlighter-rouge">æ¨Šåº†å…ƒ</code>çš„è”ç³»äººå‘é€<code class="language-plaintext highlighter-rouge">â€œæˆ‘åˆšå­¦å®Œï¼Œæ—©å®‰â€</code>
è®©å·ç‹ä»¬æ„Ÿå—ææƒ§å§ï¼ï¼ï¼</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="k">if</span> <span class="p">((</span><span class="k">await</span> <span class="nx">contact</span><span class="p">.</span><span class="nx">alias</span><span class="p">())</span> <span class="o">===</span> <span class="nx">config</span><span class="p">.</span><span class="nx">MYSELF</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">"</span><span class="s2">å®šæ—¶</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">å®šæ—¶</span><span class="dl">"</span><span class="p">);</span>
         <span class="kd">const</span> <span class="nx">remain</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">å®šæ—¶</span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span> <span class="c1">// åˆ†å‰²æŒ‡ä»¤æ–‡æœ¬</span>
   
         <span class="kd">const</span> <span class="nx">timeAndStr</span> <span class="o">=</span> <span class="nx">remain</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">);</span> <span class="c1">// æ—¶é—´å’Œæ¶ˆæ¯å†…å®¹</span>
   
         <span class="kd">const</span> <span class="nx">timeStr</span> <span class="o">=</span> <span class="nx">timeAndStr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2">.</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// ç²¾ç¡®æ—¶é—´</span>
         <span class="kd">const</span> <span class="nx">txt</span> <span class="o">=</span> <span class="nx">timeAndStr</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// æ¶ˆæ¯æ–‡æœ¬</span>
         <span class="kd">const</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">timeAndStr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// æ”¶ä¿¡äººå¤‡æ³¨</span>
         <span class="kd">const</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">schedule</span><span class="p">.</span><span class="nx">scheduleMsg</span><span class="p">(</span><span class="nx">timeStr</span><span class="p">);</span>
   
         <span class="nx">schedule</span><span class="p">.</span><span class="nx">setSchedule</span><span class="p">(</span>
           <span class="nx">date</span><span class="p">,</span>
           <span class="k">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">txt</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
             <span class="kd">const</span> <span class="nx">contact</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">bot</span><span class="p">.</span><span class="nx">Contact</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">alias</span><span class="p">:</span> <span class="nx">target</span> <span class="p">});</span> <span class="c1">// æ”¶ä¿¡äºº</span>
             <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`å‘</span><span class="p">${</span><span class="nx">contact</span><span class="p">.</span><span class="nx">name</span><span class="p">()}</span><span class="s2">å‘é€'</span><span class="p">${</span><span class="nx">txt</span><span class="p">}</span><span class="s2">'`</span><span class="p">);</span>
             <span class="nx">contact</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">txt</span><span class="p">);</span>
           <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">txt</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="c1">// é€šè¿‡bind()å¯å‘å†…éƒ¨å‡½æ•°æŒ‚è½½å‚æ•°</span>
         <span class="p">);</span>
         <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
       <span class="p">}</span>
   <span class="p">}</span>
</code></pre></div></div>

<h3 id="26-å¯†ç ç°¿">2.6 å¯†ç ç°¿</h3>

<p>è¯¥åŠŸèƒ½å¯ç”¨äºè®°å½•<strong>å¸¸ç”¨çš„å†—é•¿æ–‡æœ¬</strong>ï¼Œä¾‹å¦‚èº«ä»½è¯å·ã€é“¶è¡Œå¡å·ã€è´­ç‰©æ—¶çš„å¥½è¯„æ¨¡æ¿ç­‰ç­‰ã€‚</p>

<p>é€šè¿‡æŒ‡ä»¤<code class="language-plaintext highlighter-rouge">map key value</code>å¯è®°å½•æ ‡ç­¾ä¸º<code class="language-plaintext highlighter-rouge">key</code>ï¼Œå†…å®¹ä¸º<code class="language-plaintext highlighter-rouge">value</code>çš„å¯†ç ï¼ˆåœ¨<code class="language-plaintext highlighter-rouge">password</code>ç›®å½•ä¸‹ç”Ÿæˆæ–‡ä»¶ï¼‰</p>

<p><img src="/assets/2022/01-wechaty-assistant-bot-opensource/map.webp" alt="image.png" /></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">"</span><span class="s2">map</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// map key value</span>
      <span class="kd">let</span> <span class="nx">command</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">map</span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span> 
      <span class="nx">command</span> <span class="o">=</span> <span class="nx">command</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">let</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">command</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="nx">key</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">md5</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span> <span class="c1">// æ–‡ä»¶ååŠ å¯†</span>
      <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">command</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="nx">value</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">aes128</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// æ–‡ä»¶åŠ å¯†</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">writefile:  </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">value</span><span class="p">);</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/../password</span><span class="dl">'</span><span class="p">,</span> <span class="nx">key</span><span class="p">),</span> <span class="nx">value</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">writeFileErr: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>é€šè¿‡æŒ‡ä»¤get keyå¯ä»¥è·å–æ ‡ç­¾ä¸ºkeyçš„å¯†ç </p>

<p><img src="/assets/2022/01-wechaty-assistant-bot-opensource/get.webp" alt="image.png" /></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">"</span><span class="s2">get</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// get key</span>
      <span class="kd">let</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">get</span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span> 
      <span class="nx">key</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">md5</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/../password</span><span class="dl">'</span><span class="p">,</span> <span class="nx">key</span><span class="p">),</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">readFileErr: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">detail</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">unaes128</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">readfile:  </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">detail</span><span class="p">);</span> <span class="c1">// æ–‡ä»¶è§£å¯†</span>
        <span class="nx">msg</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">detail</span><span class="p">);</span>
      <span class="p">})</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ–‡ä»¶åŠ å¯†</p>

<p>æ–‡ä»¶åé€šè¿‡<code class="language-plaintext highlighter-rouge">md5</code>ç®—æ³•æ¯”å¯¹</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto</span><span class="dl">"</span><span class="p">);</span>
   
   <span class="cm">/**
    * @func æ–‡ä»¶ååŠ å¯†
    * @param {æ˜æ–‡} str 
    * @returns åŠ å¯†åçš„å­—ç¬¦ä¸²
    */</span>
   <span class="kd">const</span> <span class="nx">md5</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
     <span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="dl">"</span><span class="s2">md5</span><span class="dl">"</span><span class="p">);</span>
     <span class="nx">hash</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
     <span class="k">return</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>
   <span class="p">};</span>
</code></pre></div></div>

<p>æ–‡ä»¶å†…å®¹é€šè¿‡<code class="language-plaintext highlighter-rouge">aes-128-cbc</code>ç®—æ³•åŠ å¯†</p>

<p><img src="/assets/2022/01-wechaty-assistant-bot-opensource/encrypt1.webp" alt="image.png" />
<img src="/assets/2022/01-wechaty-assistant-bot-opensource/encrypt2.webp" alt="image.png" /></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="cm">/**
    * @func aes-128-cbcåŠ å¯†ç®—æ³•å°è£…
    * @param {å¯†é’¥} key 
    * @param {åˆå§‹åŒ–å‘é‡} iv 
    * @param {æ˜æ–‡} data 
    * @returns 
    */</span>
   <span class="kd">function</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
     <span class="kd">let</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createCipheriv</span><span class="p">(</span><span class="dl">"</span><span class="s2">aes-128-cbc</span><span class="dl">"</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">);</span>
     <span class="k">return</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">base64</span><span class="dl">"</span><span class="p">)</span> <span class="o">+</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">final</span><span class="p">(</span><span class="dl">"</span><span class="s2">base64</span><span class="dl">"</span><span class="p">);</span>
   <span class="p">}</span>
   
   <span class="cm">/**
    * @func aes-128-cbcè§£å¯†ç®—æ³•å°è£…
    * @param {å¯†é’¥} key 
    * @param {åˆå§‹åŒ–å‘é‡} iv 
    * @param {å¯†æ–‡} data 
    * @returns 
    */</span>
   <span class="kd">function</span> <span class="nx">decrypt</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">,</span> <span class="nx">encrypted</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">,</span> <span class="dl">"</span><span class="s2">base64</span><span class="dl">"</span><span class="p">);</span>
     <span class="kd">let</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createDecipheriv</span><span class="p">(</span><span class="dl">"</span><span class="s2">aes-128-cbc</span><span class="dl">"</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">);</span>
     <span class="k">return</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">)</span> <span class="o">+</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">final</span><span class="p">(</span><span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">);</span>
   <span class="p">}</span>
   
   <span class="cm">/**
    * @func åŠ å¯†æ–‡ä»¶å†…å®¹
    * @param {æ˜æ–‡} data 
    * @returns åŠ å¯†åçš„æ–‡ä»¶å†…å®¹
    */</span> 
   <span class="kd">const</span> <span class="nx">aes128</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">key</span><span class="o">=</span><span class="dl">"</span><span class="s2">123456789abcdefg</span><span class="dl">"</span><span class="p">,</span> <span class="nx">iv</span><span class="o">=</span><span class="dl">"</span><span class="s2">123456789abcdefg</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
   <span class="p">};</span>
   
   <span class="cm">/**
    * @func è§£å¯†æ–‡ä»¶å†…å®¹
    * @param {å¯†é’¥} key 
    * @param {åˆå§‹åŒ–å‘é‡} iv 
    * @param {å¯†æ–‡} data 
    * @returns 
    */</span>
   <span class="kd">const</span> <span class="nx">unaes128</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">key</span><span class="o">=</span><span class="dl">"</span><span class="s2">123456789abcdefg</span><span class="dl">"</span><span class="p">,</span> <span class="nx">iv</span><span class="o">=</span><span class="dl">"</span><span class="s2">123456789abcdefg</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="nx">decrypt</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
   <span class="p">};</span>
</code></pre></div></div>

<h2 id="ä¸‰ç›®å½•ç»“æ„">ä¸‰ã€ç›®å½•ç»“æ„</h2>

<p><code class="language-plaintext highlighter-rouge">config</code>æ–‡ä»¶å¤¹å­˜æ”¾å…¬å…±é…ç½®æ–‡ä»¶ä»¥åŠ<code class="language-plaintext highlighter-rouge">superagent</code>è¯·æ±‚ç›¸å…³é…ç½®</p>

<p><code class="language-plaintext highlighter-rouge">imgs</code>å­˜æ”¾ç›¸å…³å›¾ç‰‡</p>

<p><code class="language-plaintext highlighter-rouge">listeners</code>å­˜æ”¾æœºå™¨äººåˆå§‹åŒ–åä¸€ç³»åˆ—äº‹ä»¶å¤„ç†(åˆ†æ¨¡å—)
<code class="language-plaintext highlighter-rouge">on-friendship.js</code>å¤„ç†å¥½å‹è¯·æ±‚
<code class="language-plaintext highlighter-rouge">on-login.js</code>å¤„ç†ç™»å½•
<code class="language-plaintext highlighter-rouge">on-message.js</code>å¤„ç†ç”¨æˆ·æ¶ˆæ¯ã€ç¾¤æ¶ˆæ¯
<code class="language-plaintext highlighter-rouge">on-scan.js</code>å¤„ç†ç™»å½•äºŒç»´ç </p>

<p><code class="language-plaintext highlighter-rouge">schedule</code>å¯¹å®šæ—¶ä»»åŠ¡<code class="language-plaintext highlighter-rouge">node-schedule</code>åº“è¿›è¡Œäº†å°è£…</p>

<p><code class="language-plaintext highlighter-rouge">superagent</code>å­˜æ”¾æ‰€æœ‰çš„æ•°æ®è¯·æ±‚ã€æ¥å£å°è£…éƒ½åœ¨æ­¤</p>

<p><code class="language-plaintext highlighter-rouge">utils</code>å…¬ç”¨æ–¹æ³•çš„å°è£…</p>

<p><code class="language-plaintext highlighter-rouge">app.js</code>å…¥å£æ–‡ä»¶</p>

<h2 id="å››å¦‚ä½•æœ¬åœ°åŒ–">å››ã€å¦‚ä½•æœ¬åœ°åŒ–</h2>

<p>éœ€ä¿®æ”¹<code class="language-plaintext highlighter-rouge">config</code>é…ç½®ï¼Œå°†é‡Œé¢çš„é…ç½®æ”¹ä¸ºè‡ªå·±çš„ã€‚æ‰“å¼€<code class="language-plaintext highlighter-rouge">config/index.js</code>æ–‡ä»¶ï¼Œ æ“ä½œå¦‚ä¸‹ï¼š</p>

<p>å®˜ç½‘æ³¨å†Œè´¦å·</p>

<p>wechaty-puppet-padlocalä¾›åº”å•†ï¼š<a href="http://pad-local.com/">http://pad-local.com/</a>
å¤©è¡Œæ•°æ®å®˜ç½‘ï¼š<a href="https://tianapi.com/">https://www.tianapi.com/</a>
èšåˆæ•°æ®å®˜ç½‘ï¼š<a href="https://www.juhe.cn/">https://www.juhe.cn/</a>
å¾®ä¿¡å¯¹è¯å¼€æ”¾å¹³å°ï¼š<a href="https://openai.weixin.qq.com/">https://openai.weixin.qq.com/</a></p>

<p>æ³¨å†ŒæˆåŠŸåï¼Œç”³è¯·ä»¥ä¸‹æ¥å£</p>

<p>å¤©è¡Œæ•°æ®
<a href="https://www.tianapi.com/apiview/62">æ¯æ—¥è‹±è¯­ä¸€å¥è¯</a>
<a href="https://www.tianapi.com/apiview/39">ç¥å›å¤</a>
<a href="https://www.tianapi.com/apiview/223">å…¨ç½‘çƒ­æœæ¦œ</a></p>

<p>èšåˆæ•°æ®
<a href="https://www.juhe.cn/docs/api/id/73">å¤©æ°”é¢„æŠ¥</a></p>

<p>æ³¨å†Œåè¯·æ‰“å¼€<code class="language-plaintext highlighter-rouge">config/index.js</code>ï¼Œå°†é¡¶éƒ¨<code class="language-plaintext highlighter-rouge">PUPPET_TOKEN</code>ã€<code class="language-plaintext highlighter-rouge">TXAPI_TOKEN</code>ã€<code class="language-plaintext highlighter-rouge">JUHEAPI_TOKEN</code>ã€<code class="language-plaintext highlighter-rouge">WXAI_TOKEN</code>æ”¹ä¸ºè‡ªå·±çš„å³å¯</p>

<p>å…¶ä»–å…è´¹æ¥å£å¯éšæ„ç”³è¯·ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œæ›´æ¢APIæœåŠ¡å•†ã€‚</p>

<h2 id="äº”è¿è¡Œ">äº”ã€è¿è¡Œ</h2>

<p>è®°å¾—å®‰è£…ä¾èµ–</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cnpm <span class="nb">install</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cnpm start
</code></pre></div></div>

<p>ç»ˆç«¯ä¼šå‡ºç°ä¸€ä¸ªäºŒç»´ç ï¼Œæ‰«ç ç™»å½•å³å¯ã€‚</p>

<p>è‹¥äºŒç»´ç æ˜¾ç¤ºçš„å¾ˆè¯¡å¼‚ï¼Œæ— æ³•æ‰«æï¼Œè¯·æ›´æ¢ç»ˆç«¯ï¼ˆå»å¾®è½¯å•†åº—ä¸‹è½½<code class="language-plaintext highlighter-rouge">Windows Terminal</code>ï¼‰ã€‚</p>

<p>æœ‰é—®é¢˜å¯é‚®ç®±å’¨è¯¢ <code class="language-plaintext highlighter-rouge">01@yizhihang.club</code></p>]]></content><author><name>yzh1255245824</name></author><category term="article" /><category term="assistant" /><category term="wechat" /><category term="improve-efficiency" /><category term="against-involution" /><summary type="html"><![CDATA[é¡¹ç›®åœ°å€]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2022/01-wechaty-assistant-bot-opensource/roll.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2022/01-wechaty-assistant-bot-opensource/roll.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">å°† wechaty-puppet å‡çº§ä¸º1.0ä»¥ä¸Šç‰ˆæœ¬</title><link href="https://wechaty.js.org/2022/01/11/upgrade-to-wechaty-puppet-1.0/" rel="alternate" type="text/html" title="å°† wechaty-puppet å‡çº§ä¸º1.0ä»¥ä¸Šç‰ˆæœ¬" /><published>2022-01-11T00:00:00+00:00</published><updated>2022-01-11T00:00:00+00:00</updated><id>https://wechaty.js.org/2022/01/11/upgrade-to-wechaty-puppet-1.0</id><content type="html" xml:base="https://wechaty.js.org/2022/01/11/upgrade-to-wechaty-puppet-1.0/"><![CDATA[<h2 id="å°†-wechaty-puppet-å‡çº§ä¸º10ä»¥ä¸Šç‰ˆæœ¬">å°† wechaty-puppet å‡çº§ä¸º1.0ä»¥ä¸Šç‰ˆæœ¬</h2>

<h2 id="å‰è¨€">å‰è¨€</h2>

<p>éšç€ Wechaty 1.0 ç‰ˆæœ¬çš„å‘å¸ƒï¼ŒWechaty çš„å‘å±•æ­£å¼è¿›å…¥æ–°çš„é˜¶æ®µï¼Œä½†è¦å‡çº§æ•´å¥—å·¥å…·åˆ°1.0ç‰ˆæœ¬ä»¥ä¸Šå¹¶ä¸å®¹æ˜“ã€‚è¿™ç¯‡åšå®¢å°†ç®€å•ä»‹ç» wechaty-puppet å‡çº§çš„ä¸»è¦æ³¨æ„äº‹é¡¹ï¼Œå¹¶æä¾›ä¸€ä¸ªç®€å•çš„è¿‡æ¸¡æ–¹æ¡ˆã€‚</p>

<h2 id="æ€»ä½“æ€è·¯">æ€»ä½“æ€è·¯</h2>

<p>Wechaty 1.0é‡‡å–äº†æ¨¡å—åŒ–ã€ç®¡é“åŒ–çš„è®¾è®¡ï¼Œå°†åŸºç¡€åŠŸèƒ½å†™åœ¨éª¨æ¶ï¼ˆskeletonï¼‰ä¸­ï¼Œç„¶åé€šè¿‡mixinæŒ‚åœ¨ç™»å½•ã€æ¶ˆæ¯ã€io ç­‰åŠŸèƒ½ã€‚è¿™æ ·åšçš„ä¸»è¦ç›®çš„æ˜¯é¿å…å›è°ƒè¿‡å¤šï¼Œä»¥åŠæ–¹ä¾¿æµ‹è¯•ã€‚wechaty-puppetä¹Ÿé‡‡ç”¨è¿™ä¸€æ€è·¯é‡æ–°è®¾è®¡ï¼Œä¸åŒçš„å¯¼å‡ºè¢«æ”¾åœ¨ä¸åŒçš„æ¨¡å—ä¸­ï¼Œè€Œä¸æ˜¯ä¸€è‚¡è„‘å¡åœ¨ puppet ä¸­ã€‚åŒæ—¶ï¼Œpuppet å®ç°åº”è¯¥è‡ªå·±å¼•ç”¨éœ€è¦ç‰ˆæœ¬çš„å…¶ä»–åŒ…ä¾‹å¦‚ file-box ç­‰ã€‚è¿™ä¹Ÿæ˜¯é™ä½è€¦åˆåº¦çš„è®¾è®¡ã€‚</p>

<h2 id="æ•°æ®ç±»å‹å¯¼å‡º">æ•°æ®ç±»å‹å¯¼å‡º</h2>

<p>å¦‚ä¸Šä¸€èŠ‚æ‰€è¯´ï¼Œæ•°æ®ç±»å‹ä¸å†èƒ½ç›´æ¥ä» wechaty-puppet ä¸­å¯¼å‡ºï¼Œè€Œæ˜¯éœ€è¦ä»ä¸åŒçš„æ¨¡å—ä¸­å¯¼å‡ºï¼Œå¹¶ä¸”åå­—ä¹Ÿæœ‰æ‰€ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼š</p>

<p>æ—§ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Puppet</span><span class="p">,</span> <span class="nx">ScanStatus</span><span class="p">,</span> <span class="nx">EventMessagePayload</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">wechaty-puppet</span><span class="dl">'</span>

<span class="kd">class</span> <span class="nx">xxxPuppet</span> <span class="k">implements</span> <span class="nx">Puppet</span> <span class="p">{</span>
  <span class="c1">// ...</span>

  <span class="k">async</span> <span class="nx">onScan</span> <span class="p">(</span><span class="nx">status</span><span class="p">:</span> <span class="nx">ScanStatus</span><span class="p">,</span> <span class="nx">qrcode</span><span class="p">?:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    
  <span class="p">}</span>

  <span class="nx">foo</span> <span class="p">(</span><span class="nx">message</span><span class="p">:</span> <span class="nx">EventMessagePayload</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åº”è¯¥æ”¹ä¸ºï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">payloads</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">Puppet</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">wechaty-puppet</span><span class="dl">'</span>

<span class="kd">class</span> <span class="nx">xxxPuppet</span> <span class="k">implements</span> <span class="nx">Puppet</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="k">async</span> <span class="nx">onScan</span> <span class="p">(</span><span class="nx">status</span><span class="p">:</span> <span class="nx">types</span><span class="p">.</span><span class="nx">ScanStatus</span><span class="p">,</span> <span class="nx">qrcode</span><span class="p">?:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nx">foo</span> <span class="p">(</span><span class="nx">message</span><span class="p">:</span> <span class="nx">payloads</span><span class="p">.</span><span class="nx">EventMessage</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="çŠ¶æ€ç®¡ç†">çŠ¶æ€ç®¡ç†</h2>

<p>wechaty-puppet å°†ä¸å†å…è®¸ puppet ä¿®æ”¹çŠ¶æ€ï¼ˆè‡³å°‘æ˜¯ä¸å»ºè®®çš„ï¼‰ã€‚åŒæ—¶ï¼Œ this.state çš„å±æ€§ä¹Ÿæœ‰æ‰€æ”¹å˜ã€‚åº”åˆ©ç”¨ä»¥ä¸‹apiè·å–çŠ¶æ€ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">isLoggedIn</span>
<span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">active</span><span class="p">()</span>
<span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">inactive</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="å¯åŠ¨åœæ­¢">å¯åŠ¨ã€åœæ­¢</h2>

<p>ä»ä»£ç å¤ç”¨çš„è§’åº¦è€ƒè™‘ï¼Œwechaty-puppet å°†æ¥ç®¡ <code class="language-plaintext highlighter-rouge">start</code> å’Œ <code class="language-plaintext highlighter-rouge">stop</code> æ–¹æ³•ï¼Œè€Œ puppet åº”è¯¥åšçš„æ˜¯é‡å†™ <code class="language-plaintext highlighter-rouge">onStart()</code> å’Œ <code class="language-plaintext highlighter-rouge">onStop()</code> ä»¥æ‰§è¡Œå¯åŠ¨åœæ­¢æ‰€éœ€è¦çš„é€»è¾‘ã€‚</p>

<h2 id="å…¶ä»–">å…¶ä»–</h2>

<p>å°½ç®¡åœ¨ wechaty-puppet@1.10 ç‰ˆæœ¬ä¸­ï¼Œhelpers æ¨¡å—ä¾æ—§æä¾›äº† file-box çš„å¯¼å‡ºï¼Œä½†å»ºè®®è‡ªå·±å¦è¡Œå¯¼å…¥ file-box ç­‰å…¶ä»–æ¨¡å—ï¼Œè¿™æ ·å¦‚æœéœ€è¦ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">FileBoxTypes</code> ç±»å‹æšä¸¾ä¹Ÿèƒ½æ–¹ä¾¿ä½¿ç”¨ã€‚
åŒæ—¶å¦‚æœ puppet è¦é…åˆ wechaty-io-client å’Œ puppet-service æ¥æä¾›è¿œç¨‹æœåŠ¡ï¼Œéœ€è¦æ³¨æ„æ–°ç‰ˆæœ¬å¯¹ token çš„ç”Ÿæˆæœ‰ä¸€äº›æ–°çš„è¦æ±‚ã€‚token éœ€è¦ä»¥ä¸€ä¸ª Server Name Indication (SNI) ä½œä¸ºå‰ç¼€ï¼Œä¾‹å¦‚ SNI ä¸º somesni ï¼Œåˆ™tokenåº”ä¸º somesni_xxxx-xxx çš„æ ¼å¼ã€‚åŒæ—¶ï¼Œè¦æœ‰ä¸€ä¸ªç­¾åè®¤è¯çš„ CA ,å¦åˆ™æ— æ³•å»ºç«‹ TLS ã€‚ï¼ˆå¯ä»¥é€šè¿‡å°† insecure ä½œä¸ºå‰ç¼€æ¥ç»•è¿‡è¿™ä¸€æ£€æŸ¥ï¼Œä½†æ­£å¦‚å…¶åï¼Œè¿™æ˜¯ä¸å®‰å…¨çš„ã€‚ï¼‰ã€‚å‚è€ƒ <a href="https://github.com/wechaty/puppet-service/issues/190">TLS &amp; SNI Problem: cannot connect to Puppet Server after Wechaty 1.0 migiration</a></p>

<h2 id="è¿‡æ¸¡æ–¹æ¡ˆ">è¿‡æ¸¡æ–¹æ¡ˆ</h2>

<p><a href="https://github.com/hcfw007/wechaty-puppet-1.0-migration">wechaty-puppet-1.0-migration</a></p>

<p>wechaty-puppet-1.0-migration åŒ…æä¾›äº†ä¸€ä¸ªè¿‡æ¸¡æ–¹æ¡ˆï¼Œä½¿å¾—ä½ å¯ä»¥åƒä»¥å‰ä» wechaty-puppet å¼•ç”¨ä¸€æ ·ä» wechaty-puppet-1.0-migration å¼•ç”¨æ‰€éœ€çš„æ¨¡å—ï¼Œä»¥ç¬¬ä¸€æ®µæ‰€è¯´çš„ä»£ç ä¸ºä¾‹ï¼š</p>

<p>ä» wechaty-puppet-1.0-migration å¯¼å…¥ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Puppet</span><span class="p">,</span> <span class="nx">ScanStatus</span><span class="p">,</span> <span class="nx">EventMessagePayload</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">wechaty-puppet-1.0-migration</span><span class="dl">'</span>

<span class="kd">class</span> <span class="nx">xxxPuppet</span> <span class="k">implements</span> <span class="nx">Puppet</span> <span class="p">{</span>
  <span class="c1">// ...</span>

  <span class="k">async</span> <span class="nx">onScan</span> <span class="p">(</span><span class="nx">status</span><span class="p">:</span> <span class="nx">ScanStatus</span><span class="p">,</span> <span class="nx">qrcode</span><span class="p">?:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    
  <span class="p">}</span>

  <span class="nx">foo</span><span class="p">(</span><span class="nx">message</span><span class="p">:</span> <span class="nx">EventMessagePayload</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ³¨æ„ï¼Œä½ ä»éœ€è‡ªå·±å®‰è£… wechaty-puppet å’Œ file-box ï¼Œè¿™æ ·å°±å¯ä»¥é€‰æ‹©è‡ªå·±æ‰€éœ€çš„ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œä½ ä»éœ€é‡å†™ Puppet ç±»ä¸­ä¿®æ”¹çš„æ–¹æ³•ï¼Œä¾‹å¦‚ <code class="language-plaintext highlighter-rouge">start()</code> æ”¹ä¸º <code class="language-plaintext highlighter-rouge">onStart()</code>ã€‚è¿™ä¸€é¡¹ç›®çš„ç›®çš„æ˜¯æ˜¯ä½ æ›´å°‘çš„ä¿®æ”¹ä»£ç ä»¥ä½¿ç”¨ wechaty-puppet æ–°ç‰ˆæœ¬çš„æ–°ç‰¹æ€§ï¼Œå»ºè®®ä¸è¦ä½œä¸ºé•¿æœŸè§£å†³æ–¹æ¡ˆï¼Œå¹¶å°½å¿«è¿ç§»åˆ°æ–°ç‰ˆæœ¬ã€‚</p>]]></content><author><name>wang-nan</name></author><category term="article" /><category term="wechaty-puppet" /><category term="wechaty-1.0" /><summary type="html"><![CDATA[å°† wechaty-puppet å‡çº§ä¸º1.0ä»¥ä¸Šç‰ˆæœ¬]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2022/01-upgrade-to-wechaty-puppet-1.0/cover.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2022/01-upgrade-to-wechaty-puppet-1.0/cover.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">åŒ—äº¬GDG|ç¤¾åŒºè¯´ï½œNG+|èŠå¤©æœºå™¨äººä¸Angular</title><link href="https://wechaty.js.org/2022/01/06/angular-tensorflow-js/" rel="alternate" type="text/html" title="åŒ—äº¬GDG|ç¤¾åŒºè¯´ï½œNG+|èŠå¤©æœºå™¨äººä¸Angular" /><published>2022-01-06T00:00:00+00:00</published><updated>2022-01-06T00:00:00+00:00</updated><id>https://wechaty.js.org/2022/01/06/angular-tensorflow-js</id><content type="html" xml:base="https://wechaty.js.org/2022/01/06/angular-tensorflow-js/"><![CDATA[<blockquote>
  <p>AI, Wechaty, Angular, and mix them altogether in JavaScript</p>
</blockquote>

<h2 id="èŠå¤©æœºå™¨äººä¸-angular">èŠå¤©æœºå™¨äººä¸ Angular</h2>

<p>äººå·¥æ™ºèƒ½çš„å‘å±•å¸¦åŠ¨äº†å¯¹è¯å¼äº¤äº’é¢†åŸŸç ”ç©¶çš„æ·±å…¥ï¼Œä»¥åŠéšç€ç§»åŠ¨äº’è”ç½‘å³æ—¶é€šè®¯å·¥å…·çš„å¤§ä¼—æ™®åŠï¼ŒChatbot çš„åº”ç”¨åœºæ™¯è¶Šæ¥è¶Šä¸°å¯Œã€‚å¦‚ä½•åŸºäºç°æœ‰çš„äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œæ„å»ºä¸€ä¸ªèŠå¤©æœºå™¨äººï¼Ÿ</p>

<p>Chatbot çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå’Œä¼ ç»Ÿçš„ç½‘é¡µå’ŒAPPäº§å“æœ‰é‚£äº›åŒºåˆ«ï¼ŸML GDE Huan å°†åŸºäºè‡ªå·±å¯¹ Chatbot çš„ä¸°å¯Œå®è·µï¼Œåˆ†äº«å’Œå±•æœ›è¿™ç±»æ–°å‹å¯¹è¯å¼äº¤äº’æ–¹å¼åŸºäºäººå·¥æ™ºèƒ½çš„æœªæ¥å‘å±•æœºä¼šã€‚</p>

<p>The development of artificial intelligence has driven the in-depth research in the field of conversational interaction, and with the popularization of mobile Internet instant messaging tools, the application scenarios of Chatbot have become more and more abundant. How to build a chatbot based on existing artificial intelligence technology? What are the differences between the entire life cycle of Chatbot and traditional web and APP products? ML GDE Huan will share his thoughts on the new opportunities that Conversational AI can bring.</p>

<ol>
  <li>Conversational User Interface (CUI) ä»‹ç»</li>
  <li>äººå·¥æ™ºèƒ½å‘å±•å›é¡¾</li>
  <li>Wechaty å¼€æºé¡¹ç›®ä»‹ç»</li>
  <li>TensorFlow.js ä»‹ç»</li>
  <li>Live Demo: åŸºäº Angular é€šè¿‡ TensorFlow.js å¯¹å¾®ä¿¡æ¶ˆæ¯åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œå®æ—¶åˆ†æ</li>
  <li>20:45-21:00 äº’åŠ¨é—®ç­”</li>
</ol>

<h2 id="è®²å¸ˆä»‹ç»">è®²å¸ˆä»‹ç»</h2>

<p>æå“æ¡“ï¼Œè°·æ­Œå¼€å‘è€…ä¸“å®¶ï¼ˆæœºå™¨å­¦ä¹ æ–¹å‘ï¼‰</p>

<ul>
  <li>TensorFlow.js å¸ƒé“å¸ˆï¼ŒAngularçˆ±å¥½è€…</li>
  <li>PreAngel å¤©ä½¿æŠ•èµ„äººï¼Œä¸“æ³¨ AI/Chatbot é¢†åŸŸåˆ›ä¸šå›¢é˜Ÿå’Œé¡¹ç›®</li>
  <li>ã€ŠChatbot ä» 0 åˆ° 1ã€‹ã€Šç®€æ˜çš„ TensorFlow 2ã€‹è”åˆä½œè€…</li>
  <li>GitHub ä¸‡æ˜Ÿå¼€æº Conversational SDK Wechaty ä½œè€…</li>
</ul>

<p>GDE (Machine Learning); Angel Investor</p>

<p>GDE (Machine Learning) and AI MVP. PreAngel Partner, Plug and Play Venture Partner in China. Active Angel Investor for AI Startups, Serial Entrepreneur with Strong Technical Background.</p>

<h2 id="presentation">Presentation</h2>

<h3 id="slides">Slides</h3>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="https://docs.google.com/presentation/d/1Gd3D8bS6OifXDsdSe0x5i6XsP_uISX3W9tR8yBA0mYs/edit?usp=sharing" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<h3 id="source-code">Source Code</h3>

<p>GitHub: <a href="https://github.com/huan/ng-plus-wechaty">https://github.com/huan/ng-plus-wechaty</a></p>

<h2 id="tutorials">Tutorials</h2>

<h3 id="wechaty-token-apply-a-token-from-wechaty-puppet-service-providers">Wechaty Token: apply a token from Wechaty Puppet Service Providers</h3>

<p>You can apply a Windows / Pad protocol token from our puppet service providers:</p>

<ol>
  <li><a href="https://github.com/wechaty/puppet-supports/issues/new/choose">Apply Wechaty Puppet Service Token</a></li>
  <li><a href="https://wechaty.js.org/docs/puppet-services/faq">Wechaty Puppet Service FAQ</a></li>
</ol>

<h4 id="create-a-wechaty-puppet-service-token-by-yourself-diy">Create a Wechaty Puppet Service Token by yourself (DIY)</h4>

<p>Copy the following shell script and then paste it into the term of your server, to setup your Wechaty token:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># learn how to DIY a Wechaty Puppet Service token at http://wechaty.js.org/docs/puppet-services/diy</span>
<span class="nb">export </span><span class="nv">WECHATY_TOKEN</span><span class="o">=</span>insecure_wechaty_puppet_service_token_diy

<span class="c"># Set port for your hostie service: must be published accessible on the internet</span>
<span class="c"># Wechaty IO Client use this port to publish the Puppet Service</span>
<span class="nb">export </span><span class="nv">WECHATY_PUPPET_SERVER_PORT</span><span class="o">=</span>48788

<span class="c"># learn more about Wechaty Puppet PadLocal at https://wechaty.js.org/docs/puppet-services/padlocal</span>
<span class="nb">export </span><span class="nv">WECHATY_PUPPET</span><span class="o">=</span>wechaty-puppet-padlocal
<span class="c"># get a 7 days free token at PadLocal official website: http://pad-local.com/</span>
<span class="nb">export </span><span class="nv">WECHATY_PUPPET_PADLOCAL_TOKEN</span><span class="o">=</span>YOUR_PADLOCAL_TOKEN_AT_HERE

<span class="nb">export </span><span class="nv">WECHATY_LOG</span><span class="o">=</span>verbose

docker run <span class="se">\</span>
  <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">-ti</span> <span class="se">\</span>
  <span class="nt">-e</span> WECHATY_LOG <span class="se">\</span>
  <span class="nt">-e</span> WECHATY_PUPPET <span class="se">\</span>
  <span class="nt">-e</span> WECHATY_PUPPET_PADLOCAL_TOKEN <span class="se">\</span>
  <span class="nt">-e</span> WECHATY_PUPPET_SERVER_PORT <span class="se">\</span>
  <span class="nt">-e</span> WECHATY_TOKEN <span class="se">\</span>
  <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$WECHATY_PUPPET_SERVER_PORT</span><span class="s2">"</span> <span class="se">\</span>
  wechaty/wechaty:0.78
</code></pre></div></div>

<blockquote>
  <p>Learn more: <a href="https://wechaty.js.org/docs/puppet-services/diy/">Puppet Service: DIY</a> This guide will help you generate a Wechaty Token for connecting to the Wechaty Puppet Service.</p>
</blockquote>

<h2 id="live-coding-explanation">Live Coding Explanation</h2>

<p>We have four steps in our live coding, they are saved in four separate branches for easy loading and testing.</p>

<h3 id="step-1-ng-new-my-app">Step 1. <code class="language-plaintext highlighter-rouge">ng new my-app</code></h3>

<p>Branch: <a href="https://github.com/huan/ng2020-wechaty/tree/ng_china_2020_step_1_ng_new_my-app">ng_china_2020_step_1_ng_new_my-app</a></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npx <span class="nt">--package</span> @angular/cli ng new my-app
<span class="nb">cd </span>my-app
ng serve <span class="nt">--open</span>
</code></pre></div></div>

<p>Learn more from <a href="https://angular.io/guide/setup-local">https://angular.io/guide/setup-local</a></p>

<h3 id="step-2-wechaty">Step 2. Wechaty</h3>

<p>Branch: <a href="https://github.com/huan/ng2020-wechaty/tree/ng_china_2020_step_2_wechaty">ng_china_2020_step_2_wechaty</a></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i @chatie/angular brolog
</code></pre></div></div>

<h4 id="appmodulets"><code class="language-plaintext highlighter-rouge">app.module.ts</code></h4>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">WechatyModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@chatie/angular</span><span class="dl">'</span>
<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">WechatyModule</span><span class="p">,</span>
    <span class="p">...</span>
  <span class="p">],</span>
  <span class="p">...</span>
</code></pre></div></div>

<h4 id="appcomponenthtml"><code class="language-plaintext highlighter-rouge">app.component.html</code></h4>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;wechaty</span>
  <span class="na">#wechaty</span>
  <span class="na">token=</span><span class="s">"insecure_wechaty_puppet_service_token_diy"</span>

  <span class="na">(heartbeat) = </span><span class="s">"onHeartbeat($event)"</span>
  <span class="na">(scan)      = </span><span class="s">"onScan($event)"</span>
  <span class="na">(login)     = </span><span class="s">"wechaty.startSyncMessage(); onLogin($event)"</span>
  <span class="na">(message)   = </span><span class="s">"onMessage($event)"</span>
<span class="nt">&gt;</span>
<span class="nt">&lt;/wechaty&gt;</span>
</code></pre></div></div>

<h3 id="step-3-tensorflowjs-toxicity">Step 3. TensorFlow.js Toxicity</h3>

<p>Branch: <a href="https://github.com/huan/ng2020-wechaty/tree/ng_china_2020_step_3_toxicity">ng_china_2020_step_3_toxicity</a></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> @tensorflow/tfjs
npm <span class="nb">install</span> @tensorflow-models/toxicity

ng generate service toxicity
</code></pre></div></div>

<p><a href="https://storage.googleapis.com/tfjs-models/demos/toxicity/index.html"><img src="/assets/2022/01-angular-tensorflow-js/toxicity.webp" alt="TensorFlow.js Toxicity Model" /></a></p>

<p>Learn more:</p>

<ol>
  <li><a href="https://github.com/tensorflow/tfjs-models/tree/master/toxicity">TensorFlow.js models: toxicity classifier source</a></li>
  <li><a href="https://storage.googleapis.com/tfjs-models/demos/toxicity/index.html">TensorFlow.js toxicity classifier demo</a>: This is a demo of the TensorFlow.js toxicity model, which classifies text according to whether it exhibits offensive attributes (i.e. profanity, sexual explicitness).</li>
  <li><a href="https://medium.com/tensorflow/text-classification-using-tensorflow-js-an-example-of-detecting-offensive-language-in-browser-e2b94e3565ce">Text classification using TensorFlow.js: An example of detecting offensive language in browser</a></li>
</ol>

<p>The traffic light code is copy/pasted from this great tutorial: <a href="https://medium.com/@robhitt/stop-in-the-name-of-the-traffic-light-c5f4d8a9d2e6">Stop in the Name of the Traffic Light</a></p>

<h2 id="resources">Resources</h2>

<ol>
  <li><a href="https://www.tensorflow.org/js/tutorials">TensorFlow.js Tutorials</a></li>
  <li><a href="https://www.tensorflow.org/js/models">TensorFlow.js Models</a></li>
  <li><a href="https://www.tensorflow.org/js/demos">TensorFlow.js Demos</a></li>
  <li><a href="https://github.com/tensorflow/tfjs-examples/">TensorFlow.js Examples</a></li>
  <li><a href="https://github.com/tensorflow/tfjs/blob/master/GALLERY.md">TensorFlow.js Gallery</a></li>
</ol>

<h2 id="about-ng">About NG+</h2>

<p>Knowledge, ideas, and insights for the Next Generation.</p>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="https://www.youtube.com/embed/SACugbTNQnc" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<p><img src="/assets/2022/01-angular-tensorflow-js/huan-ng-2020.webp" alt="NG2020 Conference Huan Wechaty Angular TensorFlow.js" /></p>

<blockquote>
  <p>Source: <a href="https://ng-plus.dev/#/conferences?year=2020">NG+ Developers Conference</a></p>
</blockquote>

<h2 id="å…³äºç¤¾åŒºè¯´">å…³äºç¤¾åŒºè¯´</h2>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="https://www.youtube.com/embed/XGBBx3_pLdg" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<blockquote>
  <p>Bilibili: <a href="https://www.bilibili.com/video/BV1Ha411q7RF">https://www.bilibili.com/video/BV1Ha411q7RF</a></p>
</blockquote>

<p>ã€Œç¤¾åŒºè¯´ã€æ˜¯ç”±è°·æ­Œå¼€å‘è€…ç¤¾åŒº (Google Developer Group)ä¸è°·æ­Œå¼€å‘è€…ä¸“å®¶è®¡åˆ’ (Google Developer Expert) è”åˆæ¨å‡ºçš„ï¼Œä¸çƒ­çˆ±æŠ€æœ¯çš„å¼€å‘è€…ä»¬äº¤æµæŠ€æœ¯ï¼Œç›´æ’­ä»£ç ï¼Œè®¨è®ºäº§å“ï¼Œåˆ†äº«å¿ƒå¾—çš„å°å‹çº¿ä¸Šä¼šè®®ï¼Œæ¯æ¬¡æ—¶é•¿45åˆ†é’Ÿåˆ°1å°æ—¶ã€‚</p>

<p><img src="/assets/2022/01-angular-tensorflow-js/huan-gdg-2021-community-talk.webp" alt="GDG Community Talk Huan Wechaty Angular TensorFlow.js" /></p>

<p>æ´»åŠ¨å°†ç”±ä¸åŒçš„è°·æ­Œå¼€å‘è€…ç¤¾åŒºä¸¾åŠï¼Œå¹¶é‚€è¯·å›½å†…ç›¸å…³æŠ€æœ¯æ–¹å‘çš„è°·æ­Œå¼€å‘è€…ä¸“å®¶ä»¥åŠå¯¹æŠ€æœ¯æœ‰çƒ­æƒ…ã€æ„¿æ„åˆ†äº«çš„å˜‰å®¾ï¼Œä¸€èµ·èŠèŠæœ€è¿‘åšçš„é¡¹ç›®ã€å†™çš„ä»£ç ï¼Œæˆ–è€…ä¸‰äº”æŠ€æœ¯å¥½å‹æ¢è®¨èŠå¤©ã€‚</p>

<blockquote>
  <p>Source: <a href="https://mp.weixin.qq.com/s/cluw2QQepzacuZFA1pJvcw">ç¤¾åŒºè¯´ï½œèŠå¤©æœºå™¨äººä¸ Angular</a></p>
</blockquote>]]></content><author><name>huan</name></author><category term="talk" /><category term="angular" /><category term="tensorflow.js" /><category term="gdg" /><summary type="html"><![CDATA[AI, Wechaty, Angular, and mix them altogether in JavaScript]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2022/01-angular-tensorflow-js/ai-angular-tensorflow-js.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2022/01-angular-tensorflow-js/ai-angular-tensorflow-js.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">wechaty åŸºäº nodejs åŸç”Ÿ http åŒ…çš„æœåŠ¡</title><link href="https://wechaty.js.org/2022/01/04/wechaty-with-node-server/" rel="alternate" type="text/html" title="wechaty åŸºäº nodejs åŸç”Ÿ http åŒ…çš„æœåŠ¡" /><published>2022-01-04T00:00:00+00:00</published><updated>2022-01-04T00:00:00+00:00</updated><id>https://wechaty.js.org/2022/01/04/wechaty-with-node-server</id><content type="html" xml:base="https://wechaty.js.org/2022/01/04/wechaty-with-node-server/"><![CDATA[<p>å¾ˆå¼€å¿ƒåŠ å…¥äº† Wechaty ç¤¾åŒºï¼Œä¹Ÿåœ¨æˆ‘çš„æ—¥å¸¸å·¥ä½œä¸­æä¾›äº†å¾ˆå¤šå¸®åŠ©ã€‚æ ¹æ®æ—¥å¸¸çš„å·¥ä½œéœ€è¦ï¼Œæˆ‘è‡ªå·±åŠ å…¥äº†ä¸€äº›è‡ªå·±éœ€è¦çš„åŠŸèƒ½ã€‚</p>

<p>ä»Šå¤©å’Œå¤§å®¶åˆ†äº«ä¸€ä¸ªå†…å®¹ï¼š</p>

<ul>
  <li>ä½¿ç”¨ nodejs åŸç”Ÿçš„ http åŒ…æ¥æ¥æ”¶ http è¯·æ±‚</li>
</ul>

<h2 id="ä½¿ç”¨èƒŒæ™¯">ä½¿ç”¨èƒŒæ™¯</h2>

<p>æˆ‘ä»¬å•ä½åœ¨æ—¥å¸¸å·¥ä½œä¸­éœ€è¦å°†å®¡æ‰¹æµä¸­å®¡æ‰¹çš„è¯¦æƒ…å‘åœ¨å¾®ä¿¡çš„å·¥ä½œç¾¤ä¸­ï¼Œå¹¶é€šçŸ¥åˆ°ç›¸å…³çš„äººå‘˜ã€‚æ­¤ç±»éœ€æ±‚åœ¨é’‰é’‰æˆ–è€…æ˜¯ä¼ä¸šå¾®ä¿¡éƒ½å¾ˆå®¹æ˜“åšåˆ°ã€‚ä½†æ˜¯å†å²åŸå› ï¼Œæˆ‘ä»¬è¿˜éƒ½æ˜¯ç”¨å¾®ä¿¡æ¥è¿›è¡Œå¤„ç†ã€‚ä¹Ÿå°±äº§ç”Ÿäº†è¿™ä¸ªéœ€æ±‚ã€‚å› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯ wechaty docker å®ç°ï¼Œæ‰€ä»¥å°±é‡‡ç”¨äº† nodejs åŸç”Ÿçš„ http æ¨¡å—è¿›è¡Œå¼€å‘ã€‚</p>

<h2 id="å®ç°">å®ç°</h2>

<p>index.js</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">import</span> <span class="p">{</span>
    <span class="nx">WechatyBuilder</span><span class="p">,</span>
    <span class="nx">ScanStatus</span><span class="p">,</span>
    <span class="nx">log</span><span class="p">,</span>
  <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">wechaty</span><span class="dl">'</span>
  
  <span class="k">import</span> <span class="nx">qrTerm</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">qrcode-terminal</span><span class="dl">'</span>
  <span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">querystring</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">querystring</span><span class="dl">'</span><span class="p">;</span>
  <span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">http</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">;</span>
  <span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">enc</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./encrypt.js</span><span class="dl">'</span><span class="p">;</span>
  <span class="cm">/**
   *
   * 1. Declare your Bot!
   *
   */</span>
  
  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">ding-dong-bot</span><span class="dl">'</span><span class="p">,</span>
  
    <span class="cm">/**
     * You can specify different puppet for different IM protocols.
     * Learn more from https://wechaty.js.org/docs/puppet-providers/
     */</span>
    <span class="c1">// puppet: 'wechaty-puppet-whatsapp'</span>
  
    <span class="cm">/**
     * You can use wechaty puppet provider 'wechaty-puppet-service'
     *   which can connect to Wechaty Puppet Services
     *   for using more powerful protocol.
     * Learn more about services (and TOKEN)from https://wechaty.js.org/docs/puppet-services/
     */</span>
    <span class="c1">// puppet: 'wechaty-puppet-service'</span>
    <span class="c1">// puppetOptions: {</span>
    <span class="c1">//   token: 'xxx',</span>
    <span class="c1">// }</span>
  <span class="p">}</span>
  
  <span class="kd">const</span> <span class="nx">bot</span> <span class="o">=</span> <span class="nx">WechatyBuilder</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
  
  
  <span class="kd">const</span> <span class="nx">hostname</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">0.0.0.0</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">8081</span><span class="p">;</span>
  <span class="cm">/**
   *
   * 2. Register event handlers for Bot
   *
   */</span>
  <span class="nx">bot</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">logout</span><span class="dl">'</span><span class="p">,</span> <span class="nx">onLogout</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">login</span><span class="dl">'</span><span class="p">,</span>  <span class="nx">onLogin</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">scan</span><span class="dl">'</span><span class="p">,</span>   <span class="nx">onScan</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span>  <span class="nx">onError</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="nx">onMessage</span><span class="p">)</span>
  
  <span class="nx">bot</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="k">async</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Bot start() fail:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>
    <span class="k">await</span> <span class="nx">bot</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">})</span>
   <span class="c1">// ä¸­é—´å¸¸è§„çš„æ–¹æ³•å¿½ç•¥......</span>
  <span class="c1">//ä¸‹é¢å°±æ˜¯å¯åŠ¨http server</span>
  <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
  
    <span class="k">if</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="o">===</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">){</span>
      <span class="c1">// é€šè¿‡reqçš„dataäº‹ä»¶ç›‘å¬å‡½æ•°ï¼Œæ¯å½“æ¥å—åˆ°è¯·æ±‚ä½“çš„æ•°æ®ï¼Œå°±ç´¯åŠ åˆ°postå˜é‡ä¸­</span>
      <span class="nx">request</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chunk</span><span class="p">){</span>
        <span class="nx">post</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">;</span>
      <span class="p">});</span>
  
      <span class="c1">// åœ¨endäº‹ä»¶è§¦å‘åï¼Œé€šè¿‡querystring.parseå°†postè§£æä¸ºçœŸæ­£çš„POSTè¯·æ±‚æ ¼å¼ï¼Œç„¶åå‘å®¢æˆ·ç«¯è¿”å›ã€‚</span>
      <span class="nx">request</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">const</span> <span class="nx">ps</span> <span class="o">=</span> <span class="nx">querystring</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">post</span><span class="p">);</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">});</span>
        <span class="c1">//æ£€æŸ¥åˆè§„åå‘é€æ¶ˆæ¯</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">check</span><span class="p">(</span><span class="nx">ps</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">//è¿™é‡Œæ˜¯å‘æŒ‡å®šå¾®ä¿¡ç¾¤ä¸­å‘æ¶ˆæ¯</span>
          <span class="nx">sendMsgToRoom</span><span class="p">(</span><span class="nx">ps</span><span class="p">[</span><span class="dl">'</span><span class="s1">room</span><span class="dl">'</span><span class="p">],</span> <span class="nx">toMsg</span><span class="p">(</span><span class="nx">ps</span><span class="p">)).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">"</span><span class="s2">å‘é€æˆåŠŸ.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">ps</span><span class="p">[</span><span class="dl">'</span><span class="s1">title</span><span class="dl">'</span><span class="p">])</span>
          <span class="p">})</span>
          <span class="kd">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
            <span class="na">status</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">info</span><span class="p">:</span> <span class="dl">"</span><span class="s2">success</span><span class="dl">"</span>
          <span class="p">});</span>
          <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
            <span class="na">status</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="na">info</span><span class="p">:</span> <span class="dl">"</span><span class="s2">éªŒè¯ä¸é€šè¿‡</span><span class="dl">"</span>
          <span class="p">});</span>
          <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="c1">// bot.do_something</span>
    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
      <span class="c1">// å‘é€å“åº”æ•°æ® "Hello World"</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">});</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">hostname</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`Server running at http://</span><span class="p">${</span><span class="nx">hostname</span><span class="p">}</span><span class="s2">:</span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">/`</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>å¯åŠ¨ docker çš„æ—¶å€™ï¼Œç›‘å¬æŒ‡å®šç«¯å£ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ 8081ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡-eï¼Œä¼ å…¥ docker ä¸­ä¾›åé¢ä½¿ç”¨</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  docker run <span class="nt">-ti</span> <span class="nt">-d</span> <span class="nt">--name</span> wechaty_http_service <span class="nt">--rm</span> <span class="nt">-p</span> <span class="s2">"8081:8081"</span> <span class="nt">-e</span> <span class="nv">WECHATY_PUPPET_PADLOCAL_TOKEN</span><span class="o">=</span><span class="s2">"your puppet token"</span> <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span><span class="s2">"</span>,target<span class="o">=</span>/bot wechaty/wechaty:latest index.js

</code></pre></div></div>

<p>http server ä¼šéšç€ wechaty å¯åŠ¨ï¼Œä¸€èµ·å¯åŠ¨ã€‚å¤§å®¶å¯ä»¥åœ¨æ¶ˆæ¯ä½“ä¸­åŠ å…¥è‡ªå·±éœ€è¦çš„å„ç§ä¿¡æ¯ï¼Œç„¶åé€šè¿‡å‘è¯¥ server å‘é€å„ç§è¯·æ±‚å‘é€æ¶ˆæ¯ã€‚</p>

<h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>

<p>1ã€ä¸ºä»€ä¹ˆæœåŠ¡å¯åŠ¨äº†ï¼Œä½†æ˜¯å‘é€è¯·æ±‚ä¸€ç›´ä¸æˆåŠŸï¼Ÿ</p>
<blockquote>
  <p>è¯·æŸ¥çœ‹æœåŠ¡å™¨è¯¥ç«¯å£æ˜¯å¦è¿é€šï¼Œæ˜¯å¦è¢«é˜²ç«å¢™ç¦æ­¢è®¿é—®</p>
</blockquote>

<p>2ã€æœåŠ¡å™¨ä¸å…è®¸åœ¨ url ååŠ ç«¯å£è®¿é—®æ€ä¹ˆåŠï¼Ÿ</p>
<blockquote>
  <p>å¯ä»¥ä½¿ç”¨ nginx,apache ç­‰è¿›è¡Œè½¬å‘ã€‚æˆ‘è¿™è¾¹ç”¨çš„æ˜¯ nginx,ç®€å•é…ç½®å¦‚ä¸‹ï¼š</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  location /wechaty/ <span class="o">{</span>
    proxy_set_header X-Real-IP <span class="nv">$remote_addr</span><span class="p">;</span>
    proxy_pass http://127.0.0.1:8081<span class="p">;</span>
    proxy_http_version 1.1<span class="p">;</span>
    proxy_set_header Upgrade <span class="nv">$http_upgrade</span><span class="p">;</span>
    proxy_set_header Connection <span class="s1">'upgrade'</span><span class="p">;</span>
    proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>
    proxy_cache_bypass <span class="nv">$http_upgrade</span><span class="p">;</span>
  <span class="o">}</span>

</code></pre></div></div>

<p>æ›´å¤šé—®é¢˜åç»­ä¼šæ ¹æ®åé¦ˆç»§ç»­è¡¥å……</p>

<h2 id="è”ç³»æ–¹å¼">è”ç³»æ–¹å¼</h2>

<ul>
  <li>Emailï¼šxiaowx2000@qq.com</li>
</ul>

<blockquote>
  <p>Author:<a href="https://github.com/xiaowx2010">@xiaowx2010</a></p>
</blockquote>]]></content><author><name>xiaowx2010</name></author><category term="article" /><category term="restful-api" /><category term="http-server" /><summary type="html"><![CDATA[å¾ˆå¼€å¿ƒåŠ å…¥äº† Wechaty ç¤¾åŒºï¼Œä¹Ÿåœ¨æˆ‘çš„æ—¥å¸¸å·¥ä½œä¸­æä¾›äº†å¾ˆå¤šå¸®åŠ©ã€‚æ ¹æ®æ—¥å¸¸çš„å·¥ä½œéœ€è¦ï¼Œæˆ‘è‡ªå·±åŠ å…¥äº†ä¸€äº›è‡ªå·±éœ€è¦çš„åŠŸèƒ½ã€‚]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2022/01-wechaty-with-node-server/img.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2022/01-wechaty-with-node-server/img.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">2021-æœŸä¸­æŠ¥å‘Š-åŸºäº5Gå¹³å°å¼€å‘puppetæ¨¡å—æ¥å…¥wechaty</title><link href="https://wechaty.js.org/2021/12/21/mid-term-wechaty-puppet-walnut-report/" rel="alternate" type="text/html" title="2021-æœŸä¸­æŠ¥å‘Š-åŸºäº5Gå¹³å°å¼€å‘puppetæ¨¡å—æ¥å…¥wechaty" /><published>2021-12-21T00:00:00+00:00</published><updated>2021-12-21T00:00:00+00:00</updated><id>https://wechaty.js.org/2021/12/21/mid-term-wechaty-puppet-walnut-report</id><content type="html" xml:base="https://wechaty.js.org/2021/12/21/mid-term-wechaty-puppet-walnut-report/"><![CDATA[<h2 id="åŸºäº-5g-å¹³å°å¼€å‘-puppet-æ¨¡å—æ¥å…¥-wechaty">åŸºäº 5G å¹³å°å¼€å‘ puppet æ¨¡å—æ¥å…¥ wechaty</h2>

<ul>
  <li>é¡¹ç›®åç§°ï¼šåŸºäº5Gæ¶ˆæ¯çš„ Wechaty Puppet æ¨¡å—çš„è®¾è®¡ä¸å®ç°</li>
  <li>å­¦ç”Ÿï¼šé²è€€é¾™</li>
  <li>å¯¼å¸ˆï¼šè‹ç•…</li>
  <li>é¡¹ç›®ä»‹ç»ï¼š<a href="https://github.com/juzibot/intern/issues/1">https://github.com/juzibot/intern/issues/1</a></li>
  <li>ä»£ç åœ°å€ï¼š<a href="https://github.com/wechaty/puppet-walnut">https://github.com/wechaty/puppet-walnut</a></li>
</ul>

<h3 id="èƒŒæ™¯ä»‹ç»">èƒŒæ™¯ä»‹ç»</h3>

<ul>
  <li>Wechaty ç¤¾åŒºç›®å‰å·²ç»æ”¯æŒå¾®ä¿¡ã€Whatsappã€ä¼ä¸šå¾®ä¿¡ã€é£ä¹¦ç­‰å¸¸è§æµè¡Œå³æ—¶é€šè®¯å·¥å…·ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡å¤šè¯­è¨€ SDK ï¼ˆæ¯”å¦‚ Python Wechatyï¼‰ è¿›è¡Œè°ƒç”¨ã€‚</li>
  <li><a href="https://wechaty.js.org/2021/03/27/rcs-messaging-chatbot/">5G Chatbot (RCS)</a> æ˜¯è¿‘æœŸä¸­å›½ç”µä¿¡è¿è¥å•†åŸºäº 5G çš„æ¶ˆæ¯æˆ˜ç•¥è½åœ°å¹³å°ï¼Œæœªæ¥çš„ 5G æ‰‹æœºå°†ä¼šå†…ç½® RCS æ¶ˆæ¯çš„å¤„ç†èƒ½åŠ›ã€‚</li>
  <li><a href="https://www.5g-msg.com/#/">ç¡¬æ ¸æ¡ƒç¤¾åŒº</a> çš„ <a href="https://wechaty.js.org/2021/03/27/rcs-messaging-chatbot/">ç”µä¿¡è¿è¥å•†å•†5G Chatbot</a> å¹³å°ã€‚</li>
</ul>

<h3 id="ç›®æ ‡è®¡åˆ’">ç›®æ ‡è®¡åˆ’</h3>

<ul>
  <li>åŸºäº 5G å¹³å°çš„å¼€æ”¾ api è¿›è¡Œå°è£…ï¼Œå®ç°ç®€å•çš„<code class="language-plaintext highlighter-rouge">ding-dong-bot</code>ã€‚</li>
  <li>ä¸°å¯Œ 5G çš„æ¶ˆæ¯æ¨¡å¼ï¼Œå®ç°æ”¯æŒå¯Œæ–‡æœ¬ã€æ–‡ä»¶ã€cssç­‰å¤šæ ·æ¶ˆæ¯æ ¼å¼çš„ puppetã€‚</li>
</ul>

<h3 id="é¡¹ç›®è¿›å±•">é¡¹ç›®è¿›å±•</h3>

<ul>
  <li>å·²ç»å®ç°çš„puppetçš„å°è£…ï¼Œæ”¯æŒç®€å•æ¶ˆæ¯ã€ä½ç½®æ¶ˆæ¯ç­‰å¤šæ ·ä¿¡æ¯æ ¼å¼ã€‚</li>
  <li>å®Œå–„äº†è”ç³»äººçš„æ¨¡å—ï¼Œå®ç°è”ç³»äººçš„æ•°æ®ç»“æ„æ•´åˆæ–¹ä¾¿wechatyçš„è°ƒç”¨ã€‚</li>
  <li>å¼•å…¥äº†æœ¬åœ°ç¼“å­˜ï¼Œå°†æ¶ˆæ¯å’Œè”ç³»äººæ¨¡å—éƒ½æ¥å…¥ç¼“å­˜ï¼Œå®ç°å¿«é€Ÿçš„åŠ è½½å’Œå­˜å‚¨ã€‚</li>
</ul>

<h3 id="æ„å»ºç»†èŠ‚">æ„å»ºç»†èŠ‚</h3>

<h4 id="1-wechatyä¸puppetçš„äº¤äº’">1. <code class="language-plaintext highlighter-rouge">Wechaty</code>ä¸<code class="language-plaintext highlighter-rouge">Puppet</code>çš„äº¤äº’</h4>

<p><img src="/assets/2021/12-mid-term-wechaty-puppet-walnut-report/wechatypuppetwalnut.webp" alt="WechatyPuppetWalnut" /></p>

<ul>
  <li>å¼€å‘è€…é€šè¿‡<code class="language-plaintext highlighter-rouge">Wechaty</code>æä¾›çš„ Api æ¥è¿›è¡Œå…·ä½“çš„äº¤äº’æ“ä½œã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">Wechaty</code>åªéœ€è¦å…·ä½“è°ƒç”¨<strong>å¼€å‘è€…æŒ‡å®šçš„<code class="language-plaintext highlighter-rouge">Puppet</code></strong>å³æ­¤å¤„çš„<code class="language-plaintext highlighter-rouge">Walnut</code>æ¥å®ç°å¼€å‘è€…éœ€è¦çš„é€»è¾‘ã€‚</li>
  <li>æˆ‘ä»¬çš„<code class="language-plaintext highlighter-rouge">Walnut</code>ç»§æ‰¿äºæŠ½è±¡çš„<code class="language-plaintext highlighter-rouge">Puppet</code>çˆ¶ç±»ï¼Œå®ç°å…¶é¢„å®šä¹‰çš„æŠ½è±¡æ–¹æ³•æ¥å®ç°å…·ä½“çš„èƒ½åŠ›ã€‚</li>
  <li>å…·ä½“çš„<code class="language-plaintext highlighter-rouge">Walnut</code>ä¼šå’Œ<code class="language-plaintext highlighter-rouge">5G</code>å¹³å°è¿›è¡Œæ•°æ®äº¤äº’ä»è€Œå®ç°çœŸæ­£çš„ ChatBotã€‚</li>
</ul>

<h4 id="2-å¾…å®ç°çš„æŠ½è±¡æ–¹æ³•">2. å¾…å®ç°çš„æŠ½è±¡æ–¹æ³•</h4>

<p>å…³äºéœ€è¦æˆ‘ä»¬å»å®ç°çš„æŠ½è±¡æ–¹æ³•éƒ½è¢«å®šä¹‰åœ¨<a href="https://github.com/wechaty/puppet/tree/main/src/mixins">Wechaty Puppetçš„mixinsç›®å½•ä¸‹</a>ã€‚</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// æ¯”å¦‚è¿™é‡Œ MessageMixin ä¸­å®šä¹‰çš„ä¸€äº›ä¸æ¶ˆæ¯æ¨¡å—ä¸­å¾…å®ç°çš„æ–¹æ³•ï¼Œæ¥å®ç°æˆ‘ä»¬æ¶ˆæ¯çš„å¤šç§æ ¼å¼å‘é€ã€‚</span>

    <span class="cm">/**
    *
    * Message
    *
    */</span>
    <span class="kd">abstract</span> <span class="nx">messageContact</span>      <span class="p">(</span><span class="nx">messageId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span>                       <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">messageFile</span>         <span class="p">(</span><span class="nx">messageId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span>                       <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">FileBoxInterface</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">messageImage</span>        <span class="p">(</span><span class="nx">messageId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">imageType</span><span class="p">:</span> <span class="nx">ImageType</span><span class="p">)</span> <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">FileBoxInterface</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">messageMiniProgram</span>  <span class="p">(</span><span class="nx">messageId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span>                       <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">MiniProgramPayload</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">messageUrl</span>          <span class="p">(</span><span class="nx">messageId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span>                       <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">UrlLinkPayload</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">messageLocation</span>     <span class="p">(</span><span class="nx">messageId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span>                       <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">LocationPayload</span><span class="o">&gt;</span>

    <span class="kd">abstract</span> <span class="nx">messageForward</span>         <span class="p">(</span><span class="nx">conversationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">messageId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,)</span>                     <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span> <span class="o">|</span> <span class="kr">string</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">messageSendContact</span>     <span class="p">(</span><span class="nx">conversationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">contactId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span>                      <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span> <span class="o">|</span> <span class="kr">string</span><span class="o">&gt;</span>
    <span class="c1">// å‘é€æ–‡ä»¶</span>
    <span class="kd">abstract</span> <span class="nx">messageSendFile</span>        <span class="p">(</span><span class="nx">conversationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">file</span><span class="p">:</span> <span class="nx">FileBoxInterface</span><span class="p">)</span>                 <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span> <span class="o">|</span> <span class="kr">string</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">messageSendMiniProgram</span> <span class="p">(</span><span class="nx">conversationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">miniProgramPayload</span><span class="p">:</span> <span class="nx">MiniProgramPayload</span><span class="p">)</span> <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span> <span class="o">|</span> <span class="kr">string</span><span class="o">&gt;</span>
    <span class="c1">// å‘é€æ–‡æœ¬ä¿¡æ¯</span>
    <span class="kd">abstract</span> <span class="nx">messageSendText</span>        <span class="p">(</span><span class="nx">conversationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">text</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">mentionIdList</span><span class="p">?:</span> <span class="kr">string</span><span class="p">[])</span> <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span> <span class="o">|</span> <span class="kr">string</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">messageSendUrl</span>         <span class="p">(</span><span class="nx">conversationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">urlLinkPayload</span><span class="p">:</span> <span class="nx">UrlLinkPayload</span><span class="p">)</span>         <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span> <span class="o">|</span> <span class="kr">string</span><span class="o">&gt;</span>
    <span class="c1">// å‘é€ä½ç½®ä¿¡æ¯</span>
    <span class="kd">abstract</span> <span class="nx">messageSendLocation</span>    <span class="p">(</span><span class="nx">conversationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">locationPayload</span><span class="p">:</span> <span class="nx">LocationPayload</span><span class="p">)</span>       <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span> <span class="o">|</span> <span class="kr">string</span><span class="o">&gt;</span>

    <span class="kd">abstract</span> <span class="nx">messageRecall</span> <span class="p">(</span><span class="nx">messageId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span>
</code></pre></div></div>

<h4 id="3-æ¶ˆæ¯æ¥æ”¶">3. æ¶ˆæ¯æ¥æ”¶</h4>

<p>ç”±äº<code class="language-plaintext highlighter-rouge">Wechaty</code>å’Œ<code class="language-plaintext highlighter-rouge">Puppet</code>çš„çº¦å®šåŸå› ï¼Œæˆ‘ä»¬éœ€è¦å»å®ç°æ¶ˆæ¯çš„ç¼“å­˜æ¨¡å¼ï¼Œæ¥çœŸæ­£çš„è®©<code class="language-plaintext highlighter-rouge">Wechaty</code>å¯ä»¥è·å¾—åˆ°<code class="language-plaintext highlighter-rouge">Puppet</code>æ‰€æ¥æ”¶åˆ°çš„æ¶ˆæ¯å†…å®¹ã€‚</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1. å½“æˆ‘ä»¬çš„ sever ç›‘å¬åˆ°æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦å»å¯¹æ¶ˆæ¯çš„å…·ä½“å†…å®¹åšä¸€ä¸ªç¼“å­˜ã€‚</span>
    <span class="c1">// è¿™é‡Œæˆ‘ä»¬éœ€è¦è‡ªå·±å®ç°ä¸€ä¸ªç¼“å­˜æ¨¡å—ï¼Œå°† message çš„å…·ä½“å†…å®¹å­˜å‚¨è¿›å»ï¼Œå¹¶ä¸”è¿”å› idã€‚</span>
    <span class="c1">// æ¨èæå“æ¡“è€å¸ˆå¼€å‘çš„ç¼“å­˜ç»„ä»¶ï¼šflash-storeã€‚ https://github.com/huan/flash-store</span>

<span class="c1">// 2. ç„¶åæˆ‘ä»¬ç”¨ Puppet è§¦å‘ä¸€ä¸ª message äº‹ä»¶ï¼ŒæŠŠæˆ‘ä»¬æœ¬åœ°ç¼“å­˜çš„ id ä¼ å‡ºå»ã€‚</span>
<span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">messageId</span><span class="p">:</span> <span class="nx">messageId</span> <span class="p">})</span>

<span class="c1">// 3. è¿™æ—¶å€™ Wechaty å·²ç»æ‹¿åˆ°æˆ‘ä»¬æ¶ˆæ¯çš„ id ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ ¹æ®ä¸€ä¸ªéœ€è¦æˆ‘ä»¬å®ç°çš„æŸ¥è¯¢æ–¹æ³•æ¥è·å–æœ¬åœ°ç¼“å­˜ã€‚</span>
<span class="nx">override</span> <span class="k">async</span> <span class="nx">messageRawPayload</span> <span class="p">(</span><span class="nx">messageId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">WalnutMessagePayload</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">.</span><span class="nx">verbose</span><span class="p">(</span><span class="dl">'</span><span class="s1">PuppetWalnut</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">messageRawPayload(%s)</span><span class="dl">'</span><span class="p">,</span> <span class="nx">messageId</span><span class="p">)</span>
  <span class="c1">// è¿™é‡Œæ ¹æ® id å»ç¼“å­˜ä¸­æŸ¥å‡ºæ¥åˆšåˆšå­˜å…¥çš„æ¶ˆæ¯</span>
<span class="p">}</span>

<span class="c1">// 4. å½“æŸ¥å‡ºå…·ä½“çš„æ¶ˆæ¯å†…å®¹åï¼Œå…¶å®å’Œæˆ‘ä»¬ Wechaty ä¸­é¢„å®šä¹‰çš„æ¶ˆæ¯ç»“æ„å¯èƒ½ä¸å¤ªä¸€è‡´ï¼Œéœ€è¦æˆ‘ä»¬è¿›è¡Œä¸€ä¸ªè½¬æ¢ã€‚</span>
<span class="nx">override</span> <span class="k">async</span> <span class="nx">messageRawPayloadParser</span> <span class="p">(</span><span class="nx">rawPayload</span><span class="p">:</span> <span class="nx">WalnutMessagePayload</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">PUPPET</span><span class="p">.</span><span class="nx">payloads</span><span class="p">.</span><span class="nx">Message</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c1">// è¿™é‡Œå®ç°è½¬æ¢è§„åˆ™ï¼šWalnutMessagePayload ===&gt; PUPPET.payloads.Message</span>
<span class="p">}</span>

<span class="c1">// ä¸è¿‡è¿™é‡Œè¦æ³¨æ„ï¼Œåœ¨æ¯æ¬¡è¿›è¡Œæ”¶å‘æ¶ˆæ¯çš„æ—¶å€™ Wechaty éƒ½ä¼šå»åŠ è½½ä¸€éæˆ‘ä»¬çš„è”ç³»äººç¼“å­˜ã€‚æ‰€ä»¥å¯¹åº”çš„è”ç³»äººç¼“å­˜çš„æ¨¡å—ä¹Ÿéœ€è¦å®ç°ï¼š</span>
<span class="c1">// contactRawPayload</span>
<span class="c1">// contactRawPayloadParser</span>
</code></pre></div></div>

<h3 id="å…³äº-5g">å…³äº 5G</h3>

<ol>
  <li>
    <p>è”ç³»äººæ¨¡å—</p>

    <p>5G æ–¹é¢ï¼Œè”ç³»äººçš„æ¦‚å¿µå¯èƒ½ä¸æˆ‘ä»¬å¹³å¸¸å…¶ä»– IM ä¸­çš„ä¸åŒã€‚ä¾æ‰˜äºè¿è¥å•†çš„ç¼˜æ•…ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªæ‰‹æœºå·ç å°±å¯ä»¥å»ç›´æ¥å‘é€æ¶ˆæ¯ï¼Œå…å»äº†åŠ å¥½å‹ä¹‹ç±»ç¹ççš„æ“ä½œã€‚<strong>æ‰€ä»¥å¯¹åº” Walnut æˆ‘ä»¬ä¼šå¯¹æ‰€æœ‰çš„å‘é€è¿‡æ¶ˆæ¯çš„è”ç³»äººå­˜å…¥ç¼“å­˜ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿæœ‰æ•ˆçš„ç§¯ç´¯æˆ‘ä»¬çš„è”ç³»äººã€‚</strong></p>
  </li>
  <li>
    <p>å¤šåª’ä½“æ¶ˆæ¯</p>

    <p>ä¾æ® <a href="https://github.com/wechaty/puppet-walnut/blob/main/docs/api-documentation-for-5G-platform.md#18">æ¥å£æ–‡æ¡£</a> ç»™å‡ºçš„ä¿¡æ¯ï¼Œ5G è¿™è¾¹æ”¯æŒå¤šæ ·çš„æ¶ˆæ¯æ ¼å¼ï¼š</p>

    <ul>
      <li>å¸¦èœå•æŒ‰é’®çš„æ¶ˆæ¯</li>
      <li>æ–‡ä»¶ç­‰å¤šåª’ä½“æ¶ˆæ¯</li>
      <li>åœ°ç†ä½ç½®å›è½ä¿¡æ¯</li>
      <li>å¸¦CSSæ ·å¼çš„å¯Œæ–‡æœ¬æ¶ˆæ¯</li>
    </ul>
  </li>
</ol>

<h3 id="è§†é¢‘å±•ç¤º">è§†é¢‘å±•ç¤º</h3>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="https://www.youtube.com/embed/i5UohqZ9uTs" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<h3 id="ç­”è¾©æŠ¥å‘Š">ç­”è¾©æŠ¥å‘Š</h3>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="/assets/js/viewer-js/#/assets/2021/12-mid-term-wechaty-puppet-walnut-report/mid-term-wechaty-puppet-walnut-report.pdf" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<h3 id="è®¡åˆ’å®‰æ’">è®¡åˆ’å®‰æ’</h3>

<ul>
  <li>å®Œå–„ Walnut çš„å‘¨è¾¹æ–‡æ¡£ï¼ŒåŒ…æ‹¬ READMEã€getting-startedç­‰ã€‚</li>
  <li>è½å®å¯Œæ–‡æœ¬ç­‰å¤šç§ä¿¡æ¯æ ¼å¼çš„å…·ä½“å®ç°ã€‚</li>
  <li>ä¼˜åŒ–é¡¹ç›®ç»“æ„ï¼Œè¿›è¡Œé¡¹ç›®éƒ¨ç½²å’Œç¨³å®šæ€§æµ‹è¯•ã€‚</li>
</ul>

<blockquote>
  <p>Author: <a href="https://github.com/fabian4">@fabian</a></p>
</blockquote>]]></content><author><name>fabian</name></author><category term="project" /><category term="5g" /><category term="puppet-walnut" /><category term="chatbot" /><category term="ecosystem" /><category term="plan" /><summary type="html"><![CDATA[åŸºäº 5G å¹³å°å¼€å‘ puppet æ¨¡å—æ¥å…¥ wechaty]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2021/12-mid-term-wechaty-puppet-walnut-report/puppet-walnut.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2021/12-mid-term-wechaty-puppet-walnut-report/puppet-walnut.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">wechaty-puppet-padlocal å®ç°åˆæ¢</title><link href="https://wechaty.js.org/2021/12/15/inner-glance-of-padlocal/" rel="alternate" type="text/html" title="wechaty-puppet-padlocal å®ç°åˆæ¢" /><published>2021-12-15T00:00:00+00:00</published><updated>2021-12-15T00:00:00+00:00</updated><id>https://wechaty.js.org/2021/12/15/inner-glance-of-padlocal</id><content type="html" xml:base="https://wechaty.js.org/2021/12/15/inner-glance-of-padlocal/"><![CDATA[<h2 id="å¼•è¨€">å¼•è¨€</h2>

<p>ç¬”è€…æ˜¯ <a href="https://wechaty.js.org/">Wechaty</a> å’Œ <a href="https://wechaty.js.org/docs/puppet-providers/padlocal">whacty-puppet-padlocal</a> çš„ä¸€åæ™®é€šç”¨æˆ·, æ›¾åœ¨ Wechaty ç¤¾åŒºä¸Šå‘å¸ƒäº†ä¸€ç¯‡åšæ–‡<a href="https://wechaty.js.org/2021/05/02/wechaty-bible-chatbot/">ã€Šå¾®ä¿¡ç¾¤æœºå™¨äºº-è¯»ç»åŠ©æ‰‹ã€‹</a>ã€‚æ­¤æ¬¡å‡ºäºå­¦ä¹ çš„ç›®çš„ï¼Œé˜…è¯»äº† Wechaty ç¤¾åŒºä¸Šå‘å¸ƒçš„ PadLocal <a href="https://wechaty.js.org/2020/10/12/puppet-padlocal-intro/">ç›¸å…³åšæ–‡</a> åŠ Github ä¸Šå¼€æºçš„ <a href="https://github.com/padlocal/wechaty-puppet-padlocal">wechaty-puppet-padlocal</a>ã€<a href="https://github.com/padlocal/padlocal-client-ts">padlocal-client-ts</a> ç­‰ä»“åº“ä»£ç ï¼Œå¯¹ whacty-puppet-padlocal çš„å®ç°åšä¸€æ¬¡ ç®€å•ã€ç²—æµ… çš„æ¢³ç†ï¼Œå¸Œæœ›èƒ½å¤Ÿå€Ÿæ­¤æœºä¼šä¸å¹¿å¤§å¼€å‘è€…æœ‰æ‰€äº¤æµï¼Œå¸®åŠ©è‡ªå·±è¿›ä¸€æ­¥å­¦ä¹  Wechaty ç”Ÿæ€ã€‚</p>

<h2 id="å¿ƒä¸­çš„ç–‘é—®">å¿ƒä¸­çš„ç–‘é—®</h2>

<p>åœ¨é˜…è¯» PadLocal ä½œè€…çš„<a href="https://wechaty.js.org/2020/10/12/puppet-padlocal-intro/">æ–‡ç« </a>ä¸­ï¼Œä½œè€…ç»™å‡ºäº† PadLocal çš„æ•´ä½“æ¶æ„æ‹“æ‰‘å›¾:</p>

<p><img src="/assets/2021/12-inner-glance-of-padlocal/topological-graph.webp" alt="image" /></p>

<p>ä½œè€…åœ¨æ–‡ä¸­æåˆ°:</p>
<blockquote>
  <p>æˆ‘ä»¬åˆ©ç”¨äº† GRPC çš„åŒå‘é€šä¿¡æœºåˆ¶ï¼Œè®© puppet æˆä¸ºä»£ç†ï¼Œå°†æ‰€æœ‰æµé‡é€šè¿‡ puppet è½¬å‘ç»™ WeChatServerã€‚åŒæ—¶ç”± puppet æ¥ç»´æŒå’Œ WeChatServer ä¹‹é—´çš„é•¿è¿æ¥ã€‚</p>
</blockquote>

<p>åœ¨è¯»åˆ°æ­¤å¤„æ—¶ï¼Œç¬”è€…äº§ç”Ÿäº†å‡ ä¸ªå¥½å¥‡çš„é—®é¢˜ï¼š</p>

<ul>
  <li>PadLocalã€PadLocalServer åœ¨ Wechaty æ•´ä½“æ¶æ„ä¸­ä¸»è¦æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ</li>
  <li>æœ‰å“ªäº›ç±»å‹çš„è¯·æ±‚éœ€è¦é€šè¿‡ grpc çš„æ–¹å¼ä¸ PadLocalServer é€šä¿¡ï¼Ÿ</li>
  <li>å¤§ä½“çš„æ‰«ç ç™»å½•æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</li>
  <li>å¤§ä½“çš„æ¶ˆæ¯æ”¶å‘æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</li>
  <li>åˆ°åº•æœ‰æ²¡æœ‰ä¸€ä¸ªçœŸå®çš„ ipad è®¾å¤‡ï¼Œåœ¨ç™»å½•ç€å¾®ä¿¡è´¦å·ï¼Ÿ</li>
</ul>

<p>å¸¦ç€è¿™å‡ ä¸ªé—®é¢˜ï¼Œç¬”è€…é˜…è¯»äº†<a href="https://github.com/padlocal/wechaty-puppet-padlocal">wechaty-puppet-padlocal</a>ã€<a href="https://github.com/padlocal/padlocal-client-ts">padlocal-client-ts</a> ç­‰ä»“åº“ä»£ç ã€‚ä¸‹æ–‡å°†ä¸ºå¤§å®¶åšç®€å•ã€ç²—æµ…çš„è§£ç­”ã€‚</p>

<h2 id="æ•´ä½“æ¶æ„">æ•´ä½“æ¶æ„</h2>

<p><img src="/assets/2021/12-inner-glance-of-padlocal/graph.webp" alt="æ•´ä½“æ¶æ„" /></p>

<p>æˆ‘ä»¬ä»ä¸Šå¾€ä¸‹çœ‹ï¼Œåœ¨åº”ç”¨å±‚æˆ‘ä»¬çš„å¾®ä¿¡æœºå™¨äººç›´æ¥ä¸ Wechaty SDK äº¤äº’ï¼Œåœ¨ Wechaty SDK ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œå¹¶ç›‘å¬ä¸€äº›äº‹ä»¶ã€‚ä¾‹å¦‚ä»¥ä¸‹ç¤ºä¾‹ä»£ç ï¼Œæˆ‘ä»¬åœ¨ Wechaty å®ä¾‹ä¸Šç›‘å¬äº† <code class="language-plaintext highlighter-rouge">scan</code>ã€<code class="language-plaintext highlighter-rouge">login</code>ã€<code class="language-plaintext highlighter-rouge">message</code> ç­‰äº‹ä»¶ï¼Œå¹¶è°ƒç”¨äº† start() æ–¹æ³•ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Importing the Wechaty npm package</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Wechaty</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">wechaty</span><span class="dl">'</span>

<span class="c1">// Initializing the bot</span>
<span class="kd">const</span> <span class="nx">bot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wechaty</span><span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">starter-bot</span><span class="dl">'</span><span class="p">,</span>
<span class="p">})</span>

<span class="c1">// Starting the bot</span>
<span class="nx">bot</span>
<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">scan</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">qrcode</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Scan QR Code to login: </span><span class="p">${</span><span class="nx">status</span><span class="p">}</span><span class="s2">\nhttps://wechaty.js.org/qrcode/</span><span class="p">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">qrcode</span><span class="p">)}</span><span class="s2">`</span><span class="p">))</span>
<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">login</span><span class="dl">'</span><span class="p">,</span>            <span class="nx">user</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`User </span><span class="p">${</span><span class="nx">user</span><span class="p">}</span><span class="s2"> logged in`</span><span class="p">))</span>
<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span>       <span class="nx">message</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Message: </span><span class="p">${</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">))</span>
<span class="p">.</span><span class="nx">start</span><span class="p">()</span>

</code></pre></div></div>

<p>è°ƒç”¨ start æ–¹æ³•åï¼Œæˆ‘ä»¬åˆ† æ–¹æ³•è°ƒç”¨ å’Œ äº‹ä»¶å“åº” ä¸¤æ¡é“¾è·¯æ¥çœ‹æ•´ä½“çš„æ¶æ„æµæ°´çº¿ã€‚</p>

<p><strong>ç¬¬ä¸€æ¡ä»ä¸Šå¾€ä¸‹çš„ æ–¹æ³•è°ƒç”¨:</strong></p>

<p><code class="language-plaintext highlighter-rouge">wechaty.start()</code> -&gt; <code class="language-plaintext highlighter-rouge">PuppetPadLocal.start()</code> -&gt; <code class="language-plaintext highlighter-rouge">client = PadLocalClient.create()</code> -&gt; <code class="language-plaintext highlighter-rouge">client.api.login({onQrCodeEventï¼ŒonLoginSuccess})</code>  -&gt; <code class="language-plaintext highlighter-rouge">client.request(pb.LoginRequest)</code> -&gt; <code class="language-plaintext highlighter-rouge">grpc call</code> -&gt; <code class="language-plaintext highlighter-rouge">PadLocalServer</code></p>

<p>åœ¨ wechaty çš„ start æµç¨‹ä¸­ï¼Œé€šè¿‡åº•å±‚ä¾èµ–çš„å±‚å±‚è°ƒç”¨ï¼Œæœ€ç»ˆåˆå§‹åŒ–è¯·æ±‚ï¼Œä¼šå˜æˆä¸€ä¸ª LoginRequest é€šè¿‡ grpc çš„æ–¹å¼å‘é€è‡³ PadLocalServerã€‚</p>

<p><strong>ç¬¬äºŒæ¡ä»ä¸‹å¾€ä¸Šçš„ äº‹ä»¶å“åº”:</strong></p>

<p><code class="language-plaintext highlighter-rouge">_onServerMessage</code> -&gt; <code class="language-plaintext highlighter-rouge">onQrCodeEvent</code> -&gt; <code class="language-plaintext highlighter-rouge">PuppetPadLocal.emit('scan', {qrcode})</code> -&gt;  <code class="language-plaintext highlighter-rouge">wechaty.emit('scan')</code> -&gt; <code class="language-plaintext highlighter-rouge">QRCode</code></p>

<p>grpcClient åœ¨æ¥æ”¶åˆ° PadLocalServer çš„å“åº”åï¼Œé€šè¿‡å›è°ƒ åŠ äº‹ä»¶è®¢é˜…çš„æ–¹å¼ï¼Œå‘ä¸Šå±‚é€çº§æŠ›å‡º scan äº‹ä»¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨å±‚å°±æ‹¿åˆ°äº†ç™»å½•äºŒç»´ç ã€‚</p>

<h2 id="å®Œæ•´çš„ç™»å½•æµç¨‹">å®Œæ•´çš„ç™»å½•æµç¨‹</h2>

<p>ä»¥ä¸Šçš„æµç¨‹ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬æåˆ°é€šè¿‡ <code class="language-plaintext highlighter-rouge">wechaty.start</code> çš„æ–¹æ³•è°ƒç”¨ åŠ <code class="language-plaintext highlighter-rouge">wechaty.on('scan')</code> æ–¹æ³•ç›‘å¬ï¼Œå¯ä»¥æ‹¿åˆ°äº†ä¸€ä¸ª QRCodeï¼Œæˆ‘ä»¬ä½¿ç”¨æ‰‹æœºæ‰«ç å³å¯å®Œæˆç™»å½•ã€‚</p>

<p>æˆ‘ä»¬åªå‘äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">LoginRequest</code> çš„è¯·æ±‚ï¼Œå“åº”æ˜¯æ‹¿åˆ°çš„æ˜¯ä¸€ä¸ª äºŒç»´ç ã€‚ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªå“åº”ï¼Œç†è®ºä¸Šä¸€æ¬¡æ–¹æ³•è°ƒç”¨å°±ç»“æŸäº†ï¼Œé‚£ä¸Šå±‚çš„ <code class="language-plaintext highlighter-rouge">login</code> çš„äº‹ä»¶ï¼Œåˆæ˜¯é€šè¿‡ä»€ä¹ˆæœºåˆ¶è§¦å‘çš„å‘¢ï¼Ÿ</p>

<p>ç­”æ¡ˆåº”è¯¥å°±æ˜¯ gRPC, ç¬”è€…æ²¡æœ‰ä½¿ç”¨è¿‡ gRPC, ä½†åœ¨ PadLocal ä½œè€…çš„æ–‡ç« ä¸­ï¼Œä»–æåˆ° gRPC å…·å¤‡åŒå‘é€šä¿¡æœºåˆ¶ï¼Œå†ç»“åˆè¿™å‡ å¤„çš„æºç </p>

<ul>
  <li><a href="https://github.com/padlocal/padlocal-client-ts/blob/7ba679d78d13aeacb67969f0d817dbabf64f9c36/src/PadLocalClientApi.ts#L24-L54">PadLocalClientApi.login</a></li>
  <li><a href="https://github.com/padlocal/padlocal-client-ts/blob/7ba679d78d13aeacb67969f0d817dbabf64f9c36/src/Request.ts#L233">Request._onServerMessage</a></li>
  <li><a href="https://github.com/padlocal/padlocal-client-ts/blob/7ba679d78d13aeacb67969f0d817dbabf64f9c36/src/Request.ts#L214">Request._completePendingRequest</a></li>
</ul>

<p>ç¬”è€…å¤§èƒ†çŒœæµ‹: åœ¨å‘èµ· LoginRequest çš„ gRPC è¯·æ±‚åï¼ŒPadLocal æœåŠ¡ç«¯ä¼šæ ¹æ®ç™»å½•çŠ¶æ€ï¼ŒæŒç»­å‘ Client ç«¯å“åº”æ¶ˆæ¯ï¼Œè§¦å‘ Client ä¸­çš„ ç™»å½•ç›¸å…³çš„å‡ ä¸ªäº‹ä»¶å›è°ƒå¦‚ <code class="language-plaintext highlighter-rouge">onQrCodeEvent</code>ã€<code class="language-plaintext highlighter-rouge">onLoginStart</code>ã€
  <code class="language-plaintext highlighter-rouge">onLoginSuccess</code>ï¼Œå¹¶ä¼šæ§åˆ¶ Client ç«¯ ä¸ Wechat Server å®Œæˆé•¿è¿æ¥çš„å»ºç«‹ã€‚ç­‰åˆ°è¿™äº›åˆå§‹åŒ–éƒ½å®Œæˆåï¼Œæ‰ä¼šé€šè¿‡ gRPC å“åº”å¤´ä¸­çš„ ack å­—æ®µï¼Œæ¥ç»“æŸè¿™æ¬¡ LoginRequest çš„ gRPC è¯·æ±‚ã€‚</p>

<p>ç”±äºå‘èµ· LoginRequest åï¼Œå¯èƒ½éœ€è¦åšé•¿æ—¶é—´ç­‰å¾…(å¦‚ç­‰å¾…ç”¨æˆ·æ‰«ç )ã€å¹¶æ§åˆ¶ Client ç«¯ä¸ Wechat Serverå»ºç«‹é•¿è¿æ¥ï¼Œæ‰€ä»¥è¿™ä¸ª gRPC çš„è¶…æ—¶ç­‰å¾…æ—¶é—´ä¹Ÿéå¸¸çš„é•¿ï¼Œæœ‰ 10 åˆ†é’Ÿä¹‹ä¹…ã€‚</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 10 min timeout</span>
<span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">createRequest</span><span class="p">({</span>
  <span class="na">requestTimeout</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<p>ç”¨ä¸€å¼ å›¾æ¥ç®€è¦ç¤ºæ„ä¸‹ï¼Œå®Œæ•´çš„ LoginRequest gRPC è°ƒç”¨æµç¨‹:</p>

<p><img src="/assets/2021/12-inner-glance-of-padlocal/login.webp" alt="image" /></p>

<h2 id="æ¶ˆæ¯å‘é€">æ¶ˆæ¯å‘é€</h2>

<p>åœ¨é€šè¿‡ Wechaty SDK å‘é€æ–‡å­—æ¶ˆæ¯æ—¶ï¼Œå¦‚ä¸Šè¿°çš„ <code class="language-plaintext highlighter-rouge">wechat.start()</code> è°ƒç”¨æµç¨‹ä¸€æ ·ï¼Œä¼šç»è¿‡ä»¥ä¸‹å±‚çº§è°ƒç”¨å‘é€è‡³ PadLocalServer</p>

<p><code class="language-plaintext highlighter-rouge">contact.say('text message')</code> -&gt; <code class="language-plaintext highlighter-rouge">PuppetPadLocal.messageSendText(toUserName,'text message')</code> -&gt;  <code class="language-plaintext highlighter-rouge">client.api.sendTextMessage(toUserName,'text message')</code> -&gt; <code class="language-plaintext highlighter-rouge">client.request(pb.SendTextMessageRequest)</code> -&gt; <code class="language-plaintext highlighter-rouge">grpc call</code> -&gt; <code class="language-plaintext highlighter-rouge">PadLocalServer</code></p>

<p>PadLocalServer ç«¯åº”è¯¥ä¼šæ ¹æ® Client çš„è¯·æ±‚ç±»å‹SendTextMessageRequestï¼Œ åœ¨ gRPC çš„å“åº”é‡Œï¼ŒæŒ‡ç¤º Client éœ€è¦é€šè¿‡ é•¿è¿æ¥å°† textMessage å‘é€ç»™ WechatyServerã€‚</p>

<p>è€Œæ‰€æœ‰é€šè¿‡é•¿è¿æ¥å‘é€ç»™ wechatyServer çš„æ•°æ®ï¼Œéƒ½éœ€è¦å†ä¸€æ¬¡ é€šè¿‡ gRPC å°†è¯·æ±‚å†…å®¹è¿›è¡ŒåŒ…è£…(å¯èƒ½æ˜¯ç”¨ç ´è§£çš„å¾®ä¿¡åŠ å¯†ç®—æ³•è¿›è¡Œå¤„ç†)ã€‚å†å°†åŒ…è£…åçš„æ•°æ®ï¼Œä¼ è¾“ç»™ wechatyServerã€‚</p>

<p>è§ä»¥ä¸‹ç¤ºæ„å›¾:</p>

<p><img src="/assets/2021/12-inner-glance-of-padlocal/send-msg.webp" alt="æ¶ˆæ¯å‘é€ç¤ºæ„å›¾" /></p>

<h3 id="æ¶ˆæ¯æ¨é€">æ¶ˆæ¯æ¨é€</h3>

<p>ç”±äº Client é€šè¿‡é•¿è¿æ¥ä¸ WechatyServer è¿›è¡Œè¿æ¥ï¼Œå¾®ä¿¡çš„æ¶ˆæ¯ï¼Œä¼šç›´æ¥åˆ°è¾¾ Client ç«¯ï¼Œä½† Client ç«¯éœ€è¦é€šè¿‡ gRPC è¯·æ±‚ï¼Œå°†æ¶ˆæ¯çš„å†…å®¹åš unpack å¤„ç†(å¯èƒ½æ˜¯ç”¨è§£å¯†ç®—æ³•)ã€‚ç„¶åæ ¹æ®æ¶ˆæ¯çš„ç±»å‹ï¼Œemit åˆ°ä¸Šå±‚ä¸­ï¼Œå®Œæˆæ¶ˆæ¯çš„æ¥æ”¶ã€‚</p>

<p><img src="/assets/2021/12-inner-glance-of-padlocal/receive-msg.webp" alt="æ¶ˆæ¯æ¨é€ç¤ºæ„å›¾" /></p>

<h2 id="é—®é¢˜è§£ç­”">é—®é¢˜è§£ç­”</h2>

<p>æœ€åæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€å¼€å§‹æåˆ°çš„å‡ ä¸ªé—®é¢˜:</p>

<ul>
  <li>PadLocalã€PadLocalServer åœ¨ Wechaty æ•´ä½“æ¶æ„ä¸­ä¸»è¦æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ</li>
  <li>æœ‰å“ªäº›ç±»å‹çš„è¯·æ±‚éœ€è¦é€šè¿‡ grpc çš„æ–¹å¼ä¸ PadLocalServer é€šä¿¡ï¼Ÿ</li>
  <li>åˆ°åº•æœ‰æ²¡æœ‰ä¸€ä¸ªçœŸå®çš„ ipad è®¾å¤‡ï¼Œåœ¨ç™»å½•ç€å¾®ä¿¡è´¦å·ï¼Ÿ</li>
</ul>

<blockquote>
  <p>PadLocalã€PadLocalServer åœ¨ Wechaty æ•´ä½“æ¶æ„ä¸­ä¸»è¦æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ</p>
</blockquote>

<p>PadLocal åœ¨æ•´ä½“æ¶æ„ä¸­æ‰®æ¼”ä¸€ä¸ª å¾®ä¿¡ iPad ç«¯ä»£ç†çš„è§’è‰²ï¼Œä»–ä¼šä¸ Wechat Server å»ºç«‹é•¿è¿æ¥ï¼Œè¿›è¡Œæ”¶å‘æ¶ˆæ¯æ“ä½œã€‚ä½† Wechaty SDK åœ¨ PadLocal ä¸Šçš„æ‰€æœ‰ä¸»åŠ¨æ–¹æ³•è°ƒç”¨ï¼Œéƒ½éœ€è¦å…ˆ é€šè¿‡ gRPC çš„æ–¹å¼ï¼Œè¯·æ±‚åˆ° PadLocalServerï¼Œ åœ¨æ”¶åˆ° PadLocalServer çš„å“åº”æŒ‡ç¤ºåï¼Œ PadLocal æ‰çŸ¥é“å¦‚ä½•è¿›è¡Œåç»­çš„æ“ä½œå¤„ç†(é€šè¿‡ é•¿/çŸ­ è¿æ¥ï¼Œæˆ–æ˜¯ HTTP è¯·æ±‚ å¾®ä¿¡æœåŠ¡ç«¯)ã€‚å¹¶ä¸”æ‰€æœ‰çš„ æ¶ˆæ¯çš„å‘é€ã€æ¥æ”¶ çš„åŠ è§£å¯†å¤„ç†ï¼Œéƒ½éœ€è¦é€šè¿‡ PadLocalServer è¿›è¡Œã€‚</p>

<blockquote>
  <p>æœ‰å“ªäº›ç±»å‹çš„è¯·æ±‚éœ€è¦é€šè¿‡ gRPC çš„æ–¹å¼ä¸ PadLocalServer é€šä¿¡ï¼Ÿ</p>
</blockquote>

<p>Wechaty SDK ä¸Šçš„æ‰€æœ‰ä¸»åŠ¨æ–¹æ³•è°ƒç”¨ï¼Œéƒ½ä¼šå˜æˆ client.api çš„æ–¹æ³•è°ƒç”¨ï¼Œæœ€åå˜æˆ gRPC è¯·æ±‚åˆ° PadLocalServerã€‚å†æ ¹æ® gRPC çš„å“åº”æŒ‡ç¤ºï¼Œä¸ Wechat Server è¿›è¡Œäº¤äº’ã€‚</p>

<blockquote>
  <p>åˆ°åº•æœ‰æ²¡æœ‰ä¸€ä¸ªçœŸå®çš„ ipad è®¾å¤‡ï¼Œåœ¨ç™»å½•ç€å¾®ä¿¡è´¦å·ï¼Ÿ</p>
</blockquote>

<p>å…¶å®ç¬”è€…é€šè¿‡ç²—æµ…çš„å­¦ä¹ ï¼Œä¹Ÿè¿˜ä¸èƒ½ç¡®å®š PadLocalServer åé¢æ˜¯å¦è¿æ¥ç€çœŸå®çš„ ipad è®¾å¤‡ï¼Œç¬”è€…åªèƒ½æ ¹æ® PadLocal ä½œè€…çš„æ–‡ç«  åŠ è®¾å¤‡æˆæœ¬ ç­‰çŒœæµ‹ï¼ŒPadLocal ä½œè€…åº”è¯¥æ˜¯å®Œå…¨ç ´è§£äº† å¾®ä¿¡ ipad ç«¯ APIï¼Œç„¶åæ¨¡æ‹Ÿå‡ºäº†ä¸€ä¸ª ipad è®¾å¤‡ã€‚</p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>æœ¬ç¯‡æ–‡ç« ç®€å•ã€ç²—æµ…åœ°æ¢³ç†äº† PadLocal çš„ç™»å½•ã€æ¶ˆæ¯æ”¶å‘æµç¨‹ã€‚PadLocal ä¸­çš„è®¸å¤šå®ç°ï¼Œç¬”è€…æ²¡æœ‰äº²è‡ªå®è·µè¿‡ï¼Œåªèƒ½æ ¹æ®çœ‹åˆ°çš„æºä»£ç è¿›è¡Œæ¨æµ‹ï¼Œå¸Œæœ›èƒ½å€Ÿç€è¿™ç¯‡æ–‡ç« ä¸æ„Ÿå…´è¶£çš„å¼€å‘è€…æœ‰æ‰€äº¤æµï¼Œå¹¶æœŸå¾…ç¤¾åŒºä¸­æœ‰æ›´å¤š PadLocal ç›¸å…³çš„å†…éƒ¨åŸç†æ€§æ–‡ç« äº§å‡ºï¼Œå¸®åŠ©æˆ‘ä»¬å­¦ä¹  Wechaty ç”Ÿæ€ã€‚</p>]]></content><author><name>kkdev163</name></author><category term="article" /><category term="blog" /><category term="padlocal" /><category term="typescript" /><summary type="html"><![CDATA[å¼•è¨€]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2021/12-inner-glance-of-padlocal/logo.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2021/12-inner-glance-of-padlocal/logo.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">ä½¿ç”¨Wechatyæ„å»ºä¸€ä¸ªå¾®ä¿¡è½¬å‘æœºå™¨äºº</title><link href="https://wechaty.js.org/2021/11/30/a-wechat-message-forward-robot/" rel="alternate" type="text/html" title="ä½¿ç”¨Wechatyæ„å»ºä¸€ä¸ªå¾®ä¿¡è½¬å‘æœºå™¨äºº" /><published>2021-11-30T00:00:00+00:00</published><updated>2021-11-30T00:00:00+00:00</updated><id>https://wechaty.js.org/2021/11/30/a-wechat-message-forward-robot</id><content type="html" xml:base="https://wechaty.js.org/2021/11/30/a-wechat-message-forward-robot/"><![CDATA[<h2 id="æ„å»ºä¸€ä¸ªå¾®ä¿¡è½¬å‘æœºå™¨äºº">æ„å»ºä¸€ä¸ªå¾®ä¿¡è½¬å‘æœºå™¨äºº</h2>

<p><a href="https://github.com/hcfw007/wechat-agent">wechat-agent</a></p>

<h2 id="å‰è¨€">å‰è¨€</h2>

<p>éšç€æ™ºèƒ½æ‰‹æœºçš„æ™®åŠï¼Œè¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹è¯•å›¾å°†å·¥ä½œå’Œå®¶åº­åˆ†å¼€ï¼Œä¾‹å¦‚ï¼Œæœ‰ä¸¤ä¸ªæ‰‹æœºå·ç ï¼Œå·¥ä½œä½¿ç”¨ä¸€ä¸ªï¼Œç”Ÿæ´»ä½¿ç”¨ä¸€ä¸ªã€‚ä¸æ­¤åŒæ—¶ï¼Œä¹Ÿæœ‰äººæ‹¥æœ‰å¤šä¸ªå¾®ä¿¡ã€‚è®¸å¤šç³»ç»Ÿå› æ­¤è´´å¿ƒçš„æ¨å‡ºäº†åº”ç”¨å¤šå¼€çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œå¹¶éæ¯ä¸ªäººçš„æ‰‹æœºéƒ½æ”¯æŒè¿™ä¸€åŠŸèƒ½ï¼Œè€Œä¸”è€ƒè™‘åˆ°æ‰‹æœºå·ä¸å¾®ä¿¡å·çš„é«˜åº¦ç»‘å®šï¼Œå¦‚æœå¯èƒ½ï¼Œè¿˜æ˜¯åˆ†å¼€æ¯”è¾ƒå®‰å…¨ã€‚å› æ­¤ï¼Œå¯¹äºè¿™ä¸€äººç¾¤ï¼Œä¸€ä¸ªå¾®ä¿¡è½¬å‘æœºå™¨äººå°±æ˜¾å¾—å¾ˆå®ç”¨äº†ã€‚</p>

<h2 id="åŸºæœ¬åŠŸèƒ½">åŸºæœ¬åŠŸèƒ½</h2>

<p>ç”±äºWechatyæä¾›çš„å¼ºå¤§åŠŸèƒ½ï¼Œä½¿å¾—å†™ä¸€ä¸ªæœºå™¨äººå˜å¾—ååˆ†ç®€å•ã€‚ç®€å•çš„æ€è€ƒå°±å¯ä»¥åšå‡ºåŸºç¡€è®¾è®¡ï¼šå½“è§¦å‘messageäº‹ä»¶æ—¶ï¼Œå°†messageè½¬å‘ç»™æŒ‡å®šçš„contactå³å¯ã€‚å½“ç„¶ï¼Œç”±äºè‡ªå·±å‘å‡ºçš„å†…å®¹ä¹Ÿä¼šè§¦å‘messageäº‹ä»¶ï¼Œå› æ­¤è¦å¯¹<code class="language-plaintext highlighter-rouge">message.talker()</code>è¿›è¡Œæ£€æŸ¥ã€‚åŒæ—¶ç”±äºç¾¤èŠçš„æ¶ˆæ¯è¿‡äºé¢‘ç¹ï¼Œå› æ­¤è¦å¯¹ç¾¤èŠçš„å†…å®¹è¿›è¡Œè¿‡æ»¤ã€‚</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">talker</span><span class="p">.</span><span class="nb">self</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// somehow talker === bot.userSelf() does not work for this puppet</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">talker</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">g</span><span class="p">.</span><span class="nx">commander</span><span class="p">.</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">room</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// this can be decided with direct object comparison, but to unify all contact deciding process, I use id here too</span>
      <span class="k">await</span> <span class="nx">processCommand</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">g</span><span class="p">.</span><span class="nx">stat</span><span class="p">.</span><span class="nx">messageReceived</span> <span class="o">++</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">room</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">g</span><span class="p">.</span><span class="nx">roomNameList</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="k">await</span> <span class="nx">room</span><span class="p">.</span><span class="nx">topic</span><span class="p">()))</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">PRE</span><span class="p">,</span> <span class="s2">`message </span><span class="p">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2"> discarded as it's from a room not in allowed list`</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">PRE</span><span class="p">,</span> <span class="s2">`forward message </span><span class="p">${</span> <span class="nx">message</span><span class="p">.</span><span class="nx">id</span> <span class="p">}</span><span class="s2"> to </span><span class="p">${</span> <span class="nx">target</span><span class="p">.</span><span class="nx">name</span><span class="p">()</span> <span class="p">}</span><span class="s2">`</span><span class="p">)</span>
    <span class="nx">g</span><span class="p">.</span><span class="nx">stat</span><span class="p">.</span><span class="nx">messageForwarded</span> <span class="o">++</span>
    <span class="k">await</span> <span class="nx">target</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span> <span class="nx">talker</span><span class="p">.</span><span class="nx">name</span><span class="p">()</span> <span class="p">}</span><span class="s2"> </span><span class="p">${</span> <span class="nx">room</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">in room </span><span class="dl">'</span> <span class="o">+</span> <span class="k">await</span> <span class="nx">room</span><span class="p">.</span><span class="nx">topic</span><span class="p">()</span> <span class="p">:</span> <span class="dl">''</span> <span class="p">}</span><span class="s2"> said:`</span><span class="p">)</span>
    <span class="c1">// await message.forward(target)</span>
    <span class="k">await</span> <span class="nx">target</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>ç”±äºæˆ‘ä½¿ç”¨çš„puppetï¼ˆdonutï¼‰å¹¶æœªæ”¯æŒforwardæ–¹æ³•ï¼Œå› æ­¤ç›®å‰ä½¿ç”¨äº†ä¸ä¼˜é›…ä¹Ÿæœ‰é—®é¢˜çš„sayæ–¹æ³•ã€‚ä»¥åä¼šå¯¹è¿™ä¸€ç‚¹è¿›è¡Œæ”¹è¿›ï¼Œæ ¹æ®ä¸åŒçš„messageç±»å‹æ¥è¿›è¡Œè½¬å‘ã€‚</p>

<h2 id="å‘é€æ¶ˆæ¯">å‘é€æ¶ˆæ¯</h2>

<p>é™¤äº†åŸºæœ¬çš„è½¬å‘åŠŸèƒ½ä¹‹å¤–ï¼Œæˆ‘è¿˜å¸Œæœ›ä»–è¿›è¡Œå¦ä¸€ä¸ªæ–¹å‘çš„è½¬å‘ï¼Œä¸ä»…å°†æ‰˜ç®¡å¾®ä¿¡çš„å†…å®¹è½¬å‘ç»™æˆ‘ï¼Œè¿˜å¯ä»¥ä¸»åŠ¨å¯¹æ‰˜ç®¡å¾®ä¿¡çš„å¥½å‹ã€ç¾¤è¿›è¡Œå‘é€ã€‚è¿™ä¹Ÿä¸éš¾å®ç°ï¼Œåœ¨å‘ç°<code class="language-plaintext highlighter-rouge">message.talker()</code>ä¸ºæŒ‡å®šçš„contactæ—¶ï¼Œå°±æ ¹æ®å†…å®¹å‘é€å†…å®¹å³å¯ã€‚</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">targetContactStr</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">targetRoomStr</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">PRE</span><span class="p">,</span> <span class="s2">`no target contact or room priveded`</span><span class="p">)</span>
    <span class="k">await</span> <span class="nx">g</span><span class="p">.</span><span class="nx">commander</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">no target contact or room priveded</span><span class="dl">'</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">PRE</span><span class="p">,</span> <span class="s2">`no content priveded`</span><span class="p">)</span>
    <span class="k">await</span> <span class="nx">g</span><span class="p">.</span><span class="nx">commander</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">no content priveded</span><span class="dl">'</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="kd">let</span> <span class="nx">target</span><span class="p">:</span> <span class="nx">Contact</span> <span class="o">|</span> <span class="nx">Room</span> <span class="o">=</span> <span class="kc">undefined</span>
  <span class="kd">let</span> <span class="nx">infoStr</span> <span class="o">=</span> <span class="s2">`saying </span><span class="p">${</span> <span class="nx">content</span> <span class="p">}</span><span class="s2"> `</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">targetContactStr</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">target</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">bot</span><span class="p">.</span><span class="nx">Contact</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="nx">targetContactStr</span> <span class="p">})</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">PRE</span><span class="p">,</span> <span class="s2">`cannot find contact matching name </span><span class="p">${</span> <span class="nx">targetContactStr</span> <span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="k">await</span> <span class="nx">g</span><span class="p">.</span><span class="nx">commander</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="s2">`cannot find contact matching name </span><span class="p">${</span> <span class="nx">targetContactStr</span> <span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">infoStr</span> <span class="o">+=</span> <span class="s2">`to contact </span><span class="p">${</span> <span class="nx">target</span><span class="p">.</span><span class="nx">name</span><span class="p">()</span> <span class="p">}</span><span class="s2">`</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">target</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">bot</span><span class="p">.</span><span class="nx">Room</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">topic</span><span class="p">:</span> <span class="nx">targetRoomStr</span> <span class="p">})</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">PRE</span><span class="p">,</span> <span class="s2">`cannot find room matching topic </span><span class="p">${</span> <span class="nx">targetContactStr</span> <span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="k">await</span> <span class="nx">g</span><span class="p">.</span><span class="nx">commander</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="s2">`cannot find contact matching name </span><span class="p">${</span> <span class="nx">targetContactStr</span> <span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">infoStr</span> <span class="o">+=</span> <span class="s2">`to contact </span><span class="p">${</span> <span class="k">await</span> <span class="nx">target</span><span class="p">.</span><span class="nx">topic</span><span class="p">()</span> <span class="p">}</span><span class="s2">`</span>
  <span class="p">}</span>
  <span class="nx">log</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">PRE</span><span class="p">,</span> <span class="nx">infoStr</span><span class="p">)</span>
  <span class="nx">g</span><span class="p">.</span><span class="nx">stat</span><span class="p">.</span><span class="nx">messageSend</span> <span class="o">++</span>
  <span class="k">await</span> <span class="nx">target</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="å…¶ä»–æŒ‡ä»¤">å…¶ä»–æŒ‡ä»¤</h2>

<p>åœ¨åŠ å…¥ä¸»åŠ¨åŠ å…¥æ¶ˆæ¯çš„åŠŸèƒ½ä¹‹åï¼Œä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œæˆ‘åˆä¸ºå…¶æ·»åŠ äº†ä¸€äº›å…¶ä»–è¾…åŠ©åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼šç¾¤æ¶ˆæ¯ç™½åå•ã€æ•°æ®ç»Ÿè®¡ã€ä½¿ç”¨å¸®åŠ©ã€è”ç³»äººåˆ—è¡¨ã€ä¿®æ”¹ç¾¤ç™½åå•ç­‰ã€‚è¿™äº›åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡æŒ‡å®šå¾®ä¿¡å¯¹æ‰˜ç®¡å¾®ä¿¡å‘é€ç‰¹å®šçš„å‘½ä»¤è¿›è¡Œè§¦å‘ã€‚</p>

<h2 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h2>

<p>ç®€å•ä½¿ç”¨å¯ä»¥ç›´æ¥è¿›è¡Œ<code class="language-plaintext highlighter-rouge">npm install</code>å’Œ<code class="language-plaintext highlighter-rouge">npm start</code>ã€‚åœ¨cloneé¡¹ç›®åéœ€è¦è¿›è¡Œä»¥ä¸‹ä¸ªäººé…ç½®ï¼š</p>

<ol>
  <li>æ–°å»º.envæ–‡ä»¶å¹¶é…ç½®DONUT_TOKENä¸ºä½ æ‰€ä½¿ç”¨çš„service token</li>
  <li>ä¿®æ”¹config/basic.config.tsï¼Œå°†targetContactNameæ”¹ä¸ºä½ å¸Œæœ›è½¬å‘çš„ç›®æ ‡å¾®ä¿¡åï¼Œå°†commanderContactNameæ”¹ä¸ºä½ å¸Œæœ›çš„æŒ‡ä»¤å¾®ä¿¡åï¼Œå°†allowedRoomsæ”¹ä¸ºå¾®ä¿¡ç¾¤ç™½åå•æ•°ç»„ã€‚</li>
</ol>

<h2 id="å®ä¾‹æˆªå›¾">å®ä¾‹æˆªå›¾</h2>

<p><img src="/assets/2021/11-a-wechat-message-forward-robot/example1.webp" alt="ç¤ºä¾‹1" />
<img src="/assets/2021/11-a-wechat-message-forward-robot/example2.webp" alt="ç¤ºä¾‹2" /></p>

<h2 id="æœªæ¥æœŸæœ›">æœªæ¥æœŸæœ›</h2>

<p>å°±æˆ‘ä¸ªäººæ¥è¯´ï¼Œä¸ºäº†æˆ‘ç›®ä¸ªäººçš„ä½¿ç”¨æ–¹ä¾¿ï¼Œè®¡åˆ’ä¸­å¢åŠ çš„åŠŸèƒ½åŒ…æ‹¬ï¼š</p>

<ol>
  <li>æ”¯æŒæ›´å¤šç§ç±»æ¶ˆæ¯ç±»å‹çš„è½¬å‘ï¼Œå°¤å…¶æ˜¯å›¾ç‰‡ã€é“¾æ¥ã€‚</li>
  <li>æ”¯æŒè®¾ç½®è¯­å¢ƒã€‚ä¾‹å¦‚è®¾ç½®contextä¸ºæŸå¾®ä¿¡åï¼Œåˆ™æ¥ä¸‹æ¥æ‰€æœ‰çš„å‘é€ä¸è§†ä¸ºæŒ‡ä»¤ï¼Œè€Œæ˜¯ç›´æ¥è½¬å‘ç»™è¯¥å¾®ä¿¡ï¼Œç›´åˆ°è¾“å…¥æŸç‰¹å®šå®‰å…¨è¯è¿›è¡Œé€€å‡ºã€‚</li>
  <li>å¯¹å…¬ä¼—å·çš„å„ç§ç‰¹æ®Šæ¶ˆæ¯è¿›è¡Œæ›´å¥½çš„é€‚é…</li>
  <li>å°†configä¸­çš„ä¸€äº›åŸºç¡€è®¾ç½®è½¬ç§»åˆ°ç¯å¢ƒå˜é‡ï¼Œä½¿å¾—dockerä½¿ç”¨æ›´ä¸ºæ–¹ä¾¿ï¼Œä¸éœ€è¦è¿›å»æ”¹æ–‡ä»¶</li>
</ol>

<h2 id="ç»“è¯­">ç»“è¯­</h2>

<p>æ„Ÿè°¢è§‚çœ‹ã€‚å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè¯·starè¿™ä¸ªå°é¡¹ç›®ã€‚å¦‚æœæœ‰ä»€ä¹ˆéœ€æ±‚æˆ–è€…bugï¼Œè¯·ç»™æˆ‘å‘issueã€‚è¯·å„ä½å¤§ä½¬ä¸åèµæ•™ã€‚</p>]]></content><author><name>wang-nan</name></author><category term="article" /><category term="study" /><category term="wechat" /><category term="message-forward" /><category term="puppet-donut" /><summary type="html"><![CDATA[æ„å»ºä¸€ä¸ªå¾®ä¿¡è½¬å‘æœºå™¨äºº]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2021/11-a-wechat-message-forward-robot/cover.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2021/11-a-wechat-message-forward-robot/cover.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">æˆåŠŸç»“é¡¹ï¼å¤§å­¦ç”Ÿçš„ä¸€å°æ­¥ï¼Œå¼€å‘è€…çš„ä¸€å¤§æ­¥</title><link href="https://wechaty.js.org/2021/11/30/report-for-summer-2021/" rel="alternate" type="text/html" title="æˆåŠŸç»“é¡¹ï¼å¤§å­¦ç”Ÿçš„ä¸€å°æ­¥ï¼Œå¼€å‘è€…çš„ä¸€å¤§æ­¥" /><published>2021-11-30T00:00:00+00:00</published><updated>2021-11-30T00:00:00+00:00</updated><id>https://wechaty.js.org/2021/11/30/report-for-summer-2021</id><content type="html" xml:base="https://wechaty.js.org/2021/11/30/report-for-summer-2021/"><![CDATA[<p>å½“ä½ è¿˜åœ¨ç–‘æƒ‘å¦‚ä½•è¿›è¡Œ5Gæ¶ˆæ¯å¼€å‘
æ‰“ç®—ç”³è¯· Chatbot è´¦å·ï¼Œç§Ÿç”¨ä¸€å°æœåŠ¡å™¨ï¼Œä¹°ä¸€æ¬¾æµ‹è¯•æ‰‹æœºæ—¶
é•¿æ²™ç†å·¥å¤§å­¦å’Œå“ˆå°”æ»¨å·¥ç¨‹å¤§å­¦çš„ä¸¤ä½å­¦ç”Ÿ
é€šè¿‡å‚ä¸â€œå¼€æºè½¯ä»¶ä¾›åº”é“¾ç‚¹äº®è®¡åˆ’ - æš‘æœŸ2021â€ï¼ˆä»¥ä¸‹ç®€ç§°â€œå¼€æºä¹‹å¤â€ï¼‰
å·²ç»å®Œæˆäº†5Gæ¶ˆæ¯çš„å…¥é—¨å¼€å‘
é‚£ä¹ˆè·ç¦»æ›´å¤šçš„å¼€å‘è€…æŠ•å…¥åˆ°5Gæ¶ˆæ¯ï¼Œè¿˜ä¼šè¿œå—ï¼Ÿ</p>

<h2 id="æ¯ä½å¼€å‘è€…éƒ½éœ€è¦æ”¯æŒ">æ¯ä½å¼€å‘è€…éƒ½éœ€è¦æ”¯æŒ</h2>

<p>åœ¨å¼€å‘ä¹‹å‰ï¼Œä½ éœ€è¦å‡†å¤‡ä»¥ä¸‹å·¥å…·ï¼š</p>

<p>5Gæ¶ˆæ¯å‘å¸ƒä»¥æ¥ï¼Œä¸»è¦è¿˜æ˜¯ CSP å‚å•†ï¼Œå…¥å›´äº†è¿è¥å•†çš„å†…æµ‹èµ„è´¨ï¼Œè¿›è¡Œ 5Gæ¶ˆæ¯å¹³å°çš„å¼€å‘ã€‚è€Œå¾ˆå¤šä¸ªäººå¼€å‘è€…ï¼Œå¯¹äºè¿™é¡¹æ–°æŠ€æœ¯ï¼Œéƒ½è¿˜æ— æ³•è¿›è¡Œå­¦ä¹ å’Œå¼€å‘ã€‚</p>

<p>ç¡¬æ ¸æ¡ƒç¤¾åŒºï¼Œä½œä¸ºå›½å†…ç¬¬ä¸€å®¶ 5Gæ¶ˆæ¯å¼€å‘è€…ç¤¾åŒºï¼Œä¹Ÿæ”¶åˆ°äº†å¤§é‡çš„ä¸ªäººå¼€å‘è€…éœ€æ±‚ã€‚</p>

<p>ä¸ºäº†èƒ½è®©ä¸ªäººå¼€å‘è€…èƒ½å¤Ÿæ—©æ—¥æ¥å…¥ï¼Œç¡¬æ ¸æ¡ƒè”åˆ Wechaty ç¤¾åŒºï¼Œåœ¨â€œå¼€æºä¹‹å¤â€æ´»åŠ¨ä¸­ï¼Œè”åˆæ¨å‡º â€œå¼€å‘æ”¯æŒç”µä¿¡è¿è¥å•† 5G Chatbot RCSçš„ Wechaty æ¥å…¥ Puppet æ¨¡å—â€é¡¹ç›®ã€‚</p>

<p>ä»¥ç¡¬æ ¸æ¡ƒç¤¾åŒºæä¾›çš„åŸºç¡€å¼€å‘ç¯å¢ƒï¼Œ Wechatyç¤¾åŒºæä¾›å¼€æºSDKçš„åˆä½œæ¨¡å¼ï¼Œä¸ºå‚ä¸é¡¹ç›®çš„å­¦ç”Ÿä»¬å‡†å¤‡äº†å®Œæ•´çš„æŠ€æœ¯è¾…å¯¼å’Œå¼€å‘å·¥å…·ã€‚</p>

<p>ç»è¿‡å¯¼å¸ˆä»¬çš„è®¤çœŸè¾…å¯¼å’Œå­¦ç”Ÿä»¬çš„åŠªåŠ›å¼€å‘ï¼Œæœ€ç»ˆï¼Œå­¦ç”Ÿä»¬æˆåŠŸæ‹¿åˆ°äº†ç»“é¡¹è¯ä¹¦ï¼</p>

<p><img src="/assets/2021/11-report-for-summer-2021/1.webp" alt="ç»“é¡¹è¯ä¹¦" /></p>

<p>æ­¤å¼€æºé¡¹ç›®ï¼Œå¯ä»¥åœ¨å¼€æºä¹‹å¤æ´»åŠ¨å®˜ç½‘è¿›è¡ŒæŸ¥çœ‹ï¼š
<a href="https://summer.iscas.ac.cn/#/org/prodetail/210220088">é¡¹ç›®åœ°å€</a></p>

<p><img src="/assets/2021/11-report-for-summer-2021/2.webp" alt="é¡¹ç›®ID" /></p>

<p>æˆ‘ä»¬çš„é¡¹ç›®ç¾¤ä¹Ÿæ˜¯éå¸¸å£®å¤§å“¦~
<img src="/assets/2021/11-report-for-summer-2021/3.webp" alt="é¡¹ç›®ç¾¤" /></p>

<h2 id="ä¸æ˜¯ç»“é¡¹è€Œæ˜¯å¼€å§‹">ä¸æ˜¯ç»“é¡¹ï¼Œè€Œæ˜¯å¼€å§‹</h2>

<p>ç¡¬æ ¸æ¡ƒç¤¾åŒºæ„Ÿè°¢æ¯ä¸€ä½æŠ•å…¥åˆ°5Gæ¶ˆæ¯é¡¹ç›®ä¸­çš„å¼€å‘è€…ï¼Œä½ ä»¬ä»Šå¤©è´¡çŒ®çš„æ¯ä¸€è¡Œä»£ç ï¼Œéƒ½æ˜¯å¯¹æœªæ¥é“ºå«çš„æœ€å¥½çš„å°é˜¶ã€‚å®ƒä»¬å°†ä¼šåµŒå…¥åˆ°æœªæ¥å¼€å‘å·¥å…·ä¸­ï¼Œä¼šæŒç»­çš„å‘å…‰å‘çƒ­ï¼Œå¸®åŠ©æ›´å¤šçš„å¼€å‘è€…ä»¬è¿›æ­¥æˆé•¿ï¼</p>

<p>æ”¯æŒ5Gæ¶ˆæ¯å¼€å‘è€…ä¸€ç›´ä»¥æ¥éƒ½æ˜¯ç¡¬æ ¸æ¡ƒç¤¾åŒºçš„äº§ä¸šè´£ä»»å’Œå·¥ä½œæ–¹å‘ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸­å›½èƒ½å¤Ÿæ—©æ—¥è½åœ° 5Gæ¶ˆæ¯æŠ€æœ¯ï¼Œè®©ç”¨æˆ·ä½¿ç”¨æ¶ˆæ¯æœåŠ¡æ—¶ï¼Œä¿¡æ¯æ›´åŠ å®‰å…¨ï¼ŒåŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œä½“éªŒæ›´åŠ ä¾¿æ·ï¼</p>

<h3 id="æœªæ¥ç¡¬æ ¸æ¡ƒç¤¾åŒºä¼šæŒç»­æ¨åŠ¨å¼€æºé¡¹ç›®åªä¸ºæ›´å¤šçš„å¼€å‘è€…èƒ½å¤ŸåŠ å…¥åˆ°5gæ¶ˆæ¯">æœªæ¥ï¼Œç¡¬æ ¸æ¡ƒç¤¾åŒºä¼šæŒç»­æ¨åŠ¨å¼€æºé¡¹ç›®ï¼Œåªä¸ºæ›´å¤šçš„å¼€å‘è€…èƒ½å¤ŸåŠ å…¥åˆ°â€œ5Gæ¶ˆæ¯â€ï¼</h3>

<ul>
  <li>é¡¹ç›®ä»“åº“: <a href="https://github.com/wechaty/wechaty-puppet-walnut">https://github.com/wechaty/wechaty-puppet-walnut</a></li>
  <li>npmåŒ…ï¼š<a href="https://www.npmjs.com/package/wechaty-puppet-walnut">https://www.npmjs.com/package/wechaty-puppet-walnut</a></li>
</ul>

<blockquote>
  <p>ä½œè€…: <a href="https://www.5g-msg.com">iron-conard</a></p>
</blockquote>]]></content><author><name>ironconrad</name></author><category term="article" /><category term="blog" /><category term="study" /><category term="wechaty-puppet-walnut" /><category term="5g-rcs" /><category term="ospp" /><category term="ospp-2021" /><category term="summer-of-wechaty" /><category term="summer-2021" /><summary type="html"><![CDATA[å½“ä½ è¿˜åœ¨ç–‘æƒ‘å¦‚ä½•è¿›è¡Œ5Gæ¶ˆæ¯å¼€å‘ æ‰“ç®—ç”³è¯· Chatbot è´¦å·ï¼Œç§Ÿç”¨ä¸€å°æœåŠ¡å™¨ï¼Œä¹°ä¸€æ¬¾æµ‹è¯•æ‰‹æœºæ—¶ é•¿æ²™ç†å·¥å¤§å­¦å’Œå“ˆå°”æ»¨å·¥ç¨‹å¤§å­¦çš„ä¸¤ä½å­¦ç”Ÿ é€šè¿‡å‚ä¸â€œå¼€æºè½¯ä»¶ä¾›åº”é“¾ç‚¹äº®è®¡åˆ’ - æš‘æœŸ2021â€ï¼ˆä»¥ä¸‹ç®€ç§°â€œå¼€æºä¹‹å¤â€ï¼‰ å·²ç»å®Œæˆäº†5Gæ¶ˆæ¯çš„å…¥é—¨å¼€å‘ é‚£ä¹ˆè·ç¦»æ›´å¤šçš„å¼€å‘è€…æŠ•å…¥åˆ°5Gæ¶ˆæ¯ï¼Œè¿˜ä¼šè¿œå—ï¼Ÿ]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2021/11-report-for-summer-2021/2.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2021/11-report-for-summer-2021/2.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Design and implementation of wechaty puppet module based on Tiktok</title><link href="https://wechaty.js.org/2021/11/29/try-to-build-a-wechaty-tiktok-puppet/" rel="alternate" type="text/html" title="Design and implementation of wechaty puppet module based on Tiktok" /><published>2021-11-29T00:00:00+00:00</published><updated>2021-11-29T00:00:00+00:00</updated><id>https://wechaty.js.org/2021/11/29/try-to-build-a-wechaty-tiktok-puppet</id><content type="html" xml:base="https://wechaty.js.org/2021/11/29/try-to-build-a-wechaty-tiktok-puppet/"><![CDATA[<h2 id="context">Context</h2>

<p>author: Sihe Yu
mentorï¼šnan Wang
For more detailed work progress and process, please refer to the following addressï¼š
<a href="https://github.com/juzibot/intern/issues/3">åŸºäºTIKTOKçš„ Wechaty puppet æ¨¡å—è®¾è®¡ä¸å®ç°</a></p>

<p>We hope that our product can have more ability to access IM, Therefore, the first thing to bear the brunt is to enable wechaty to stably access more IM.</p>

<p>Tiktok is a popular short video software all over the world, but in addition to short video, it also has strong social attributes and provides social functions including single chat and group chat.
In order to enable wechaty users to send and receive messages using tiktok, it is necessary to develop the corresponding puppet access module.</p>

<h2 id="goal">Goal</h2>

<p>During the internship, we hope to achieve the following objectives:
The messaging function needs to implement the most basic dingdong BOT, that is, the robot will automatically reply to Dong after receiving Ding
Need to support contact list and group list
The code needs to be hosted on GitHub</p>

<h2 id="bot-basic-information">Bot Basic information</h2>

<p>intelligent tiktok robot based on the platform of shaking table, providing an intelligent robot customer service system with sales, marketing and after-sale services. It helps the enterprise to get customers quickly, enhance user stickiness and improve transformation through intelligent dialogue, customer service system and data analysis. It covers education, retail, insurance and other industries.</p>

<ul>
  <li>
    <p>Application Name: chatbot</p>
  </li>
  <li>
    <p>Application type: Website application</p>
  </li>
  <li>
    <p>Application category: Social communication</p>
  </li>
</ul>

<h2 id="project-steps">Project steps</h2>

<ol>
  <li>implement dingdong based on tiktok development platform.</li>
  <li>Encapsulate the logic flow into a puppet</li>
  <li>Add our newly encapsulated puppet to wechaty</li>
</ol>

<h2 id="current-progress">Current progress</h2>

<ol>
  <li>Achieve DingDong bot with TikTok Api</li>
</ol>

<h2 id="proposal-video-presentation">Proposal Video Presentation</h2>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="https://www.youtube.com/embed/N-Yswi7BnG4" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<h2 id="proposal-slides">Proposal Slides</h2>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="/assets/js/viewer-js/#/assets/2021/11-try-to-build-a-wechaty-tiktok-puppet/mid-term-ppt.pdf" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<h2 id="plans">Plans</h2>

<h2 id="-recent-plan">* Recent plan</h2>

<ol>
  <li>Read Puppet-Mock code and try to integrate DingDong into it.</li>
  <li>(optional) base on that, implements room (group) control and message. (There is no room api in TikTok doc. I tried to consult the custom service but no result so far)</li>
</ol>

<h2 id="-long-term-plan">* Long term plan</h2>

<ol>
  <li>Encapsulate the logic flow into a puppet</li>
  <li>Add our newly encapsulated puppet to wechaty</li>
</ol>]]></content><author><name>yusihe88</name></author><category term="project" /><category term="puppet-tiktok" /><category term="tiktok" /><category term="automotive" /><summary type="html"><![CDATA[Context]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2021/11-try-to-build-a-wechaty-tiktok-puppet/wechaty-tiktok-puppet.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2021/11-try-to-build-a-wechaty-tiktok-puppet/wechaty-tiktok-puppet.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>